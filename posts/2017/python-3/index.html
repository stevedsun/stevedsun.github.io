<!doctype html><html lang=zh-CN><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://sund.site/favicon.ico><title>ã€ŠPythonæºç å‰–æã€‹ç¬¬ä¸‰éƒ¨åˆ†â€”â€”Pythonè™šæ‹Ÿæœºè¿›é˜¶ | Steve Sun</title>
<meta name=title content="ã€ŠPythonæºç å‰–æã€‹ç¬¬ä¸‰éƒ¨åˆ†â€”â€”Pythonè™šæ‹Ÿæœºè¿›é˜¶"><meta name=description content="Python ç¯å¢ƒåˆå§‹åŒ–
è¿›ç¨‹å¯åŠ¨ååˆ›å»º PyInterpreterObjectï¼ŒPyInterpreterObject é‡Œé¢ç»´æŠ¤äº†å…¨å±€ module æ˜ å°„è¡¨interp->modulesï¼Œè¯¥è¡¨é»˜è®¤åˆå§‹åŒ–ä¸ºbuildinæ¨¡å—ï¼Œ
Python çš„ import æœºåˆ¶

Python è™šæ‹Ÿæœºåœ¨æ‰§è¡Œâ€œimport Aâ€æ—¶ï¼Œä¼šä¸º package A åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¼šåœ¨è¯¥ module ç»´æŠ¤çš„ dict ä¸­æ·»åŠ ä¸¤ä¸ªè¡¨ç¤ºå…ƒä¿¡æ¯çš„å±æ€§ï¼šnameå’Œpathã€‚è€Œ Python è™šæ‹Ÿæœºä» A/init.py ä¸­æ‰§è¡Œâ€œimport mod1â€æ—¶ï¼Œä¹Ÿä¼šä¸º mod1 åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¾ç½®nameå±æ€§ï¼Œä½†æ˜¯è¿™æ—¶å°±ä¸è®¾ç½®pathå±æ€§äº†ã€‚


package æ˜¯ç”± module èšåˆè€Œæˆã€‚æ›´æ¸…æ¥šçš„è¡¨è¿°æ˜¯ï¼šmodule å±äºä¸€ä¸ª packageã€‚æˆ‘ä»¬ä¸èƒ½è¯´ï¼Œmodule1 å±äº module2ã€‚æˆ‘ä»¬å‰é¢å·²ç»çœ‹åˆ°ï¼Œmodule çš„è·¯å¾„å®é™…ä¸Šæ˜¯ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œä»å›¾ 14-11 ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ ‘çŠ¶ç»“æ„ä¸­ï¼Œmodule çš„çˆ¶èŠ‚ç‚¹åªèƒ½æ˜¯ packageï¼Œè€Œä¸å¯èƒ½æ˜¯å¦ä¸€ä¸ª moduleã€‚

GIL
Python è™šæ‹Ÿæœºä½¿ç”¨ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ï¼ˆGlobal Interpreter Lockï¼ŒGILï¼‰æ¥äº’æ–¥çº¿ç¨‹å¯¹ python è™šæ‹Ÿæœºçš„ä½¿ç”¨ã€‚
æ³¨æ„è¿™é‡Œ GIL æ˜¯è§£é‡Šå™¨ä¸€çº§çš„äº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨ python è§£é‡Šå™¨ã€‚æ‰€ä»¥GIL æ˜¯ç”¨æ¥è®©æ“ä½œç³»ç»Ÿä¸­åˆ†é…çš„å¤šä¸ªçº¿ç¨‹äº’æ–¥çš„ä½¿ç”¨ python è§£é‡Šå™¨çš„ï¼Œæ˜¯å»ºç«‹åœ¨ç³»ç»Ÿçº¿ç¨‹è°ƒåº¦åŸºç¡€ä¹‹ä¸Šçš„ä¸€å¥— C API äº’æ–¥æœºåˆ¶ï¼Œæ˜¯æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹èµ„æºæ›´å¤§ç²’åº¦çš„é”ã€‚
Python çš„çº¿ç¨‹æ˜¯åŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹çš„ï¼Œæ‰€ä»¥ python çš„çº¿ç¨‹ä¸æ˜¯ã€Œè™šæ‹Ÿå‡ºæ¥çš„ã€ã€‚

é‚£ä¹ˆç©¶ç«Ÿ Python ä¼šåœ¨ä¼—å¤šçš„ç­‰å¾…çº¿ç¨‹ä¸­é€‰æ‹©å“ªä¸€ä¸ªå¹¸è¿å„¿å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸çŸ¥é“ã€‚æ²¡é”™ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒPython å®Œå…¨æ²¡æœ‰æ’æ‰‹ï¼Œè€Œæ˜¯äº¤ç»™äº†åº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥è§£å†³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython å€Ÿç”¨äº†åº•å±‚æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å†³å®šä¸‹ä¸€ä¸ªè¿›å…¥ Python è§£é‡Šå™¨çš„çº¿ç¨‹ç©¶ç«Ÿæ˜¯è°ã€‚"><meta name=keywords content="python,"><link rel=canonical href=https://sund.site/posts/2017/python-3/><meta property="og:url" content="https://sund.site/posts/2017/python-3/"><meta property="og:site_name" content="Steve Sun"><meta property="og:title" content="ã€ŠPythonæºç å‰–æã€‹ç¬¬ä¸‰éƒ¨åˆ†â€”â€”Pythonè™šæ‹Ÿæœºè¿›é˜¶"><meta property="og:description" content="Python ç¯å¢ƒåˆå§‹åŒ– è¿›ç¨‹å¯åŠ¨ååˆ›å»º PyInterpreterObjectï¼ŒPyInterpreterObject é‡Œé¢ç»´æŠ¤äº†å…¨å±€ module æ˜ å°„è¡¨interp->modulesï¼Œè¯¥è¡¨é»˜è®¤åˆå§‹åŒ–ä¸ºbuildinæ¨¡å—ï¼Œ
Python çš„ import æœºåˆ¶ Python è™šæ‹Ÿæœºåœ¨æ‰§è¡Œâ€œimport Aâ€æ—¶ï¼Œä¼šä¸º package A åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¼šåœ¨è¯¥ module ç»´æŠ¤çš„ dict ä¸­æ·»åŠ ä¸¤ä¸ªè¡¨ç¤ºå…ƒä¿¡æ¯çš„å±æ€§ï¼šnameå’Œpathã€‚è€Œ Python è™šæ‹Ÿæœºä» A/init.py ä¸­æ‰§è¡Œâ€œimport mod1â€æ—¶ï¼Œä¹Ÿä¼šä¸º mod1 åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¾ç½®nameå±æ€§ï¼Œä½†æ˜¯è¿™æ—¶å°±ä¸è®¾ç½®pathå±æ€§äº†ã€‚
package æ˜¯ç”± module èšåˆè€Œæˆã€‚æ›´æ¸…æ¥šçš„è¡¨è¿°æ˜¯ï¼šmodule å±äºä¸€ä¸ª packageã€‚æˆ‘ä»¬ä¸èƒ½è¯´ï¼Œmodule1 å±äº module2ã€‚æˆ‘ä»¬å‰é¢å·²ç»çœ‹åˆ°ï¼Œmodule çš„è·¯å¾„å®é™…ä¸Šæ˜¯ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œä»å›¾ 14-11 ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ ‘çŠ¶ç»“æ„ä¸­ï¼Œmodule çš„çˆ¶èŠ‚ç‚¹åªèƒ½æ˜¯ packageï¼Œè€Œä¸å¯èƒ½æ˜¯å¦ä¸€ä¸ª moduleã€‚
GIL Python è™šæ‹Ÿæœºä½¿ç”¨ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ï¼ˆGlobal Interpreter Lockï¼ŒGILï¼‰æ¥äº’æ–¥çº¿ç¨‹å¯¹ python è™šæ‹Ÿæœºçš„ä½¿ç”¨ã€‚
æ³¨æ„è¿™é‡Œ GIL æ˜¯è§£é‡Šå™¨ä¸€çº§çš„äº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨ python è§£é‡Šå™¨ã€‚æ‰€ä»¥GIL æ˜¯ç”¨æ¥è®©æ“ä½œç³»ç»Ÿä¸­åˆ†é…çš„å¤šä¸ªçº¿ç¨‹äº’æ–¥çš„ä½¿ç”¨ python è§£é‡Šå™¨çš„ï¼Œæ˜¯å»ºç«‹åœ¨ç³»ç»Ÿçº¿ç¨‹è°ƒåº¦åŸºç¡€ä¹‹ä¸Šçš„ä¸€å¥— C API äº’æ–¥æœºåˆ¶ï¼Œæ˜¯æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹èµ„æºæ›´å¤§ç²’åº¦çš„é”ã€‚
Python çš„çº¿ç¨‹æ˜¯åŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹çš„ï¼Œæ‰€ä»¥ python çš„çº¿ç¨‹ä¸æ˜¯ã€Œè™šæ‹Ÿå‡ºæ¥çš„ã€ã€‚
é‚£ä¹ˆç©¶ç«Ÿ Python ä¼šåœ¨ä¼—å¤šçš„ç­‰å¾…çº¿ç¨‹ä¸­é€‰æ‹©å“ªä¸€ä¸ªå¹¸è¿å„¿å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸çŸ¥é“ã€‚æ²¡é”™ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒPython å®Œå…¨æ²¡æœ‰æ’æ‰‹ï¼Œè€Œæ˜¯äº¤ç»™äº†åº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥è§£å†³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython å€Ÿç”¨äº†åº•å±‚æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å†³å®šä¸‹ä¸€ä¸ªè¿›å…¥ Python è§£é‡Šå™¨çš„çº¿ç¨‹ç©¶ç«Ÿæ˜¯è°ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-07-14T00:00:00+00:00"><meta property="article:modified_time" content="2017-07-14T00:00:00+00:00"><meta property="article:tag" content="Python"><meta property="og:image" content="https://sund.site/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sund.site/images/share.png"><meta name=twitter:title content="ã€ŠPythonæºç å‰–æã€‹ç¬¬ä¸‰éƒ¨åˆ†â€”â€”Pythonè™šæ‹Ÿæœºè¿›é˜¶"><meta name=twitter:description content="Python ç¯å¢ƒåˆå§‹åŒ– è¿›ç¨‹å¯åŠ¨ååˆ›å»º PyInterpreterObjectï¼ŒPyInterpreterObject é‡Œé¢ç»´æŠ¤äº†å…¨å±€ module æ˜ å°„è¡¨interp->modulesï¼Œè¯¥è¡¨é»˜è®¤åˆå§‹åŒ–ä¸ºbuildinæ¨¡å—ï¼Œ
Python çš„ import æœºåˆ¶ Python è™šæ‹Ÿæœºåœ¨æ‰§è¡Œâ€œimport Aâ€æ—¶ï¼Œä¼šä¸º package A åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¼šåœ¨è¯¥ module ç»´æŠ¤çš„ dict ä¸­æ·»åŠ ä¸¤ä¸ªè¡¨ç¤ºå…ƒä¿¡æ¯çš„å±æ€§ï¼šnameå’Œpathã€‚è€Œ Python è™šæ‹Ÿæœºä» A/init.py ä¸­æ‰§è¡Œâ€œimport mod1â€æ—¶ï¼Œä¹Ÿä¼šä¸º mod1 åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¾ç½®nameå±æ€§ï¼Œä½†æ˜¯è¿™æ—¶å°±ä¸è®¾ç½®pathå±æ€§äº†ã€‚
package æ˜¯ç”± module èšåˆè€Œæˆã€‚æ›´æ¸…æ¥šçš„è¡¨è¿°æ˜¯ï¼šmodule å±äºä¸€ä¸ª packageã€‚æˆ‘ä»¬ä¸èƒ½è¯´ï¼Œmodule1 å±äº module2ã€‚æˆ‘ä»¬å‰é¢å·²ç»çœ‹åˆ°ï¼Œmodule çš„è·¯å¾„å®é™…ä¸Šæ˜¯ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œä»å›¾ 14-11 ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ ‘çŠ¶ç»“æ„ä¸­ï¼Œmodule çš„çˆ¶èŠ‚ç‚¹åªèƒ½æ˜¯ packageï¼Œè€Œä¸å¯èƒ½æ˜¯å¦ä¸€ä¸ª moduleã€‚
GIL Python è™šæ‹Ÿæœºä½¿ç”¨ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ï¼ˆGlobal Interpreter Lockï¼ŒGILï¼‰æ¥äº’æ–¥çº¿ç¨‹å¯¹ python è™šæ‹Ÿæœºçš„ä½¿ç”¨ã€‚
æ³¨æ„è¿™é‡Œ GIL æ˜¯è§£é‡Šå™¨ä¸€çº§çš„äº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨ python è§£é‡Šå™¨ã€‚æ‰€ä»¥GIL æ˜¯ç”¨æ¥è®©æ“ä½œç³»ç»Ÿä¸­åˆ†é…çš„å¤šä¸ªçº¿ç¨‹äº’æ–¥çš„ä½¿ç”¨ python è§£é‡Šå™¨çš„ï¼Œæ˜¯å»ºç«‹åœ¨ç³»ç»Ÿçº¿ç¨‹è°ƒåº¦åŸºç¡€ä¹‹ä¸Šçš„ä¸€å¥— C API äº’æ–¥æœºåˆ¶ï¼Œæ˜¯æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹èµ„æºæ›´å¤§ç²’åº¦çš„é”ã€‚
Python çš„çº¿ç¨‹æ˜¯åŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹çš„ï¼Œæ‰€ä»¥ python çš„çº¿ç¨‹ä¸æ˜¯ã€Œè™šæ‹Ÿå‡ºæ¥çš„ã€ã€‚
é‚£ä¹ˆç©¶ç«Ÿ Python ä¼šåœ¨ä¼—å¤šçš„ç­‰å¾…çº¿ç¨‹ä¸­é€‰æ‹©å“ªä¸€ä¸ªå¹¸è¿å„¿å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸çŸ¥é“ã€‚æ²¡é”™ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒPython å®Œå…¨æ²¡æœ‰æ’æ‰‹ï¼Œè€Œæ˜¯äº¤ç»™äº†åº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥è§£å†³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython å€Ÿç”¨äº†åº•å±‚æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å†³å®šä¸‹ä¸€ä¸ªè¿›å…¥ Python è§£é‡Šå™¨çš„çº¿ç¨‹ç©¶ç«Ÿæ˜¯è°ã€‚"><meta itemprop=name content="ã€ŠPythonæºç å‰–æã€‹ç¬¬ä¸‰éƒ¨åˆ†â€”â€”Pythonè™šæ‹Ÿæœºè¿›é˜¶"><meta itemprop=description content="Python ç¯å¢ƒåˆå§‹åŒ– è¿›ç¨‹å¯åŠ¨ååˆ›å»º PyInterpreterObjectï¼ŒPyInterpreterObject é‡Œé¢ç»´æŠ¤äº†å…¨å±€ module æ˜ å°„è¡¨interp->modulesï¼Œè¯¥è¡¨é»˜è®¤åˆå§‹åŒ–ä¸ºbuildinæ¨¡å—ï¼Œ
Python çš„ import æœºåˆ¶ Python è™šæ‹Ÿæœºåœ¨æ‰§è¡Œâ€œimport Aâ€æ—¶ï¼Œä¼šä¸º package A åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¼šåœ¨è¯¥ module ç»´æŠ¤çš„ dict ä¸­æ·»åŠ ä¸¤ä¸ªè¡¨ç¤ºå…ƒä¿¡æ¯çš„å±æ€§ï¼šnameå’Œpathã€‚è€Œ Python è™šæ‹Ÿæœºä» A/init.py ä¸­æ‰§è¡Œâ€œimport mod1â€æ—¶ï¼Œä¹Ÿä¼šä¸º mod1 åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¾ç½®nameå±æ€§ï¼Œä½†æ˜¯è¿™æ—¶å°±ä¸è®¾ç½®pathå±æ€§äº†ã€‚
package æ˜¯ç”± module èšåˆè€Œæˆã€‚æ›´æ¸…æ¥šçš„è¡¨è¿°æ˜¯ï¼šmodule å±äºä¸€ä¸ª packageã€‚æˆ‘ä»¬ä¸èƒ½è¯´ï¼Œmodule1 å±äº module2ã€‚æˆ‘ä»¬å‰é¢å·²ç»çœ‹åˆ°ï¼Œmodule çš„è·¯å¾„å®é™…ä¸Šæ˜¯ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œä»å›¾ 14-11 ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ ‘çŠ¶ç»“æ„ä¸­ï¼Œmodule çš„çˆ¶èŠ‚ç‚¹åªèƒ½æ˜¯ packageï¼Œè€Œä¸å¯èƒ½æ˜¯å¦ä¸€ä¸ª moduleã€‚
GIL Python è™šæ‹Ÿæœºä½¿ç”¨ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ï¼ˆGlobal Interpreter Lockï¼ŒGILï¼‰æ¥äº’æ–¥çº¿ç¨‹å¯¹ python è™šæ‹Ÿæœºçš„ä½¿ç”¨ã€‚
æ³¨æ„è¿™é‡Œ GIL æ˜¯è§£é‡Šå™¨ä¸€çº§çš„äº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨ python è§£é‡Šå™¨ã€‚æ‰€ä»¥GIL æ˜¯ç”¨æ¥è®©æ“ä½œç³»ç»Ÿä¸­åˆ†é…çš„å¤šä¸ªçº¿ç¨‹äº’æ–¥çš„ä½¿ç”¨ python è§£é‡Šå™¨çš„ï¼Œæ˜¯å»ºç«‹åœ¨ç³»ç»Ÿçº¿ç¨‹è°ƒåº¦åŸºç¡€ä¹‹ä¸Šçš„ä¸€å¥— C API äº’æ–¥æœºåˆ¶ï¼Œæ˜¯æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹èµ„æºæ›´å¤§ç²’åº¦çš„é”ã€‚
Python çš„çº¿ç¨‹æ˜¯åŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹çš„ï¼Œæ‰€ä»¥ python çš„çº¿ç¨‹ä¸æ˜¯ã€Œè™šæ‹Ÿå‡ºæ¥çš„ã€ã€‚
é‚£ä¹ˆç©¶ç«Ÿ Python ä¼šåœ¨ä¼—å¤šçš„ç­‰å¾…çº¿ç¨‹ä¸­é€‰æ‹©å“ªä¸€ä¸ªå¹¸è¿å„¿å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸çŸ¥é“ã€‚æ²¡é”™ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒPython å®Œå…¨æ²¡æœ‰æ’æ‰‹ï¼Œè€Œæ˜¯äº¤ç»™äº†åº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥è§£å†³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython å€Ÿç”¨äº†åº•å±‚æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å†³å®šä¸‹ä¸€ä¸ªè¿›å…¥ Python è§£é‡Šå™¨çš„çº¿ç¨‹ç©¶ç«Ÿæ˜¯è°ã€‚"><meta itemprop=datePublished content="2017-07-14T00:00:00+00:00"><meta itemprop=dateModified content="2017-07-14T00:00:00+00:00"><meta itemprop=wordCount content="696"><meta itemprop=image content="https://sund.site/images/share.png"><meta itemprop=keywords content="Python"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width-max:720px;--font-primary:Verdana, sans-serif;--font-secondary:monospace;--font-size-primary:1em;--font-size-secondary:0.8em;--body-bg-color:#fcfcfc;--bold-text-color:#222;--body-text-color:#444;--link-color:#3273dc;--link-visited-color:#8b6fcb;--table-border-color:#f2f2f2;--table-th-bg-color:#f2f2f2;--img-border-color:#f2f2f2;--code-bg-color:#f2f2f2;--code-text-color:#222;--blockquote-border-color:#666;--blockquote-text-color:#666;--upvoted-color:#FA8072}@media(prefers-color-scheme:dark){:root{--body-bg-color:#1c1c1c;--bold-text-color:#eee;--body-text-color:#ddd;--link-color:#8cc2dd;--link-visited-color:#c3b1ee;--table-border-color:#999;--table-th-bg-color:#999;--img-border-color:#999;--code-bg-color:#555;--code-text-color:#ddd;--blockquote-border-color:#ccc;--blockquote-text-color:#ccc}}body{font-family:var(--font-primary);font-size:var(--font-size-primary);margin:auto;padding:20px;max-width:var(--width-max);text-align:left;background-color:var(--body-bg-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--body-text-color)}h1,h2,h3,h4,h5,h6,strong,b{color:var(--bold-text-color)}h1,h2,h3,h4,h5,h6{margin:16px 0}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}.title{text-decoration:none;border:0}.title:hover{text-decoration:none}.title span{font-weight:400}nav a{margin-right:8px}textarea{width:100%;font-size:16px}input{font-size:14px}content{line-height:1.6}table{width:100%;border-collapse:collapse;border:1px solid var(--table-border-color);border-radius:4px}th,td{border:1px solid var(--table-border-color);padding:4px}th{background-color:var(--table-th-bg-color)}hr{border:0;border-top:1px dashed}img{max-width:100%;display:block;margin-left:auto;margin-right:auto;border:1px solid var(--img-border-color);border-radius:4px;content-visibility:auto;loading:lazy}img[src*="#minipic"]{max-width:50%;margin-left:0;margin-right:auto}i{font-style:normal}time{font-family:var(--font-secondary);font-size:15px}code{font-family:var(--font-secondary);background-color:var(--code-bg-color);color:var(--code-text-color);padding:2px;border-radius:4px}pre code{display:block;padding:16px;white-space:pre-wrap;overflow-x:auto}div.highlight pre{border-radius:4px}div.highlight code{background-color:var(--code-bg-color);color:var(--code-text-color)}blockquote{border-left:2px solid var(--blockquote-border-color);color:var(--blockquote-text-color);margin:0;padding-left:16px;font-style:normal}blockquote p{margin:0}footer{padding:25px 0;text-align:center;font-size:var(--font-size-secondary)}ul li:has(input){list-style-type:none;margin-left:-25.5px}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li span.grouped{flex:0 0 80px}ul.blog-posts li a:visited{color:var(--link-visited-color)}div.toc{position:fixed;top:50%;left:calc((100vw + var(--width-max))/2);transform:translateY(-50%);width:calc((90vw - var(--width-max))/2);max-height:80vh;overflow-y:auto;padding:20px 8px;z-index:99;&::-webkit-scrollbar { display:none; } -ms-overflow-style:none;scrollbar-width:none}div.toc ul{list-style-type:none;padding-left:0}div.toc ul li{margin:8px 0}div.toc ul li a{text-decoration:none;color:var(--blockquote-text-color)}div.toc ul li a:hover{color:var(--link-color)}button.upvote-btn{margin:0;padding:0;border:none;background:0 0;cursor:pointer;display:flex;flex-direction:column;align-items:center;color:var(--body-text-color)}button.upvoted{color:var(--upvoted-color)}span.upvote-count{margin-top:-4px;font-size:smaller}@media(max-width:500px){img[src*="#minipic"]{max-width:100%;margin-left:auto;margin-right:auto}div.toc{display:none}}</style><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/GuanKiapTsingKhai/dist/GuanKiapTsingKhai/result.css><style>body,div.post-body,h1,h2,h3,h4{font-family:microsoft yahei,pingfang sc,avenir,segoe ui,hiragino sans gb,STHeiti,microsoft sans serif,wenquanyi micro hei,sans-serif}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-XJJVVQ0LBH"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XJJVVQ0LBH")</script></head><body><header><a href=/ class=title><h1>Steve Sun</h1></a><nav><a href=/>Home</a>
<a href=/friends/>Friends</a>
<a href=/posts/>Posts</a></nav></header><main><h1>ã€ŠPythonæºç å‰–æã€‹ç¬¬ä¸‰éƒ¨åˆ†â€”â€”Pythonè™šæ‹Ÿæœºè¿›é˜¶</h1><p><i><time datetime=2017-07-14 pubdate>14 Jul, 2017</time></i></p><content><h2 id=python-ç¯å¢ƒåˆå§‹åŒ–>Python ç¯å¢ƒåˆå§‹åŒ–</h2><p>è¿›ç¨‹å¯åŠ¨ååˆ›å»º PyInterpreterObjectï¼ŒPyInterpreterObject é‡Œé¢ç»´æŠ¤äº†å…¨å±€ module æ˜ å°„è¡¨<code>interp->modules</code>ï¼Œè¯¥è¡¨é»˜è®¤åˆå§‹åŒ–ä¸º<strong>buildin</strong>æ¨¡å—ï¼Œ</p><h2 id=python-çš„-import-æœºåˆ¶>Python çš„ import æœºåˆ¶</h2><blockquote><p>Python è™šæ‹Ÿæœºåœ¨æ‰§è¡Œâ€œimport Aâ€æ—¶ï¼Œä¼šä¸º package A åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¼šåœ¨è¯¥ module ç»´æŠ¤çš„ dict ä¸­æ·»åŠ ä¸¤ä¸ªè¡¨ç¤ºå…ƒä¿¡æ¯çš„å±æ€§ï¼š<strong>name</strong>å’Œ<strong>path</strong>ã€‚è€Œ Python è™šæ‹Ÿæœºä» A/<strong>init</strong>.py ä¸­æ‰§è¡Œâ€œimport mod1â€æ—¶ï¼Œä¹Ÿä¼šä¸º mod1 åˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¾ç½®<strong>name</strong>å±æ€§ï¼Œä½†æ˜¯è¿™æ—¶å°±ä¸è®¾ç½®<strong>path</strong>å±æ€§äº†ã€‚</p></blockquote><blockquote><p>package æ˜¯ç”± module èšåˆè€Œæˆã€‚æ›´æ¸…æ¥šçš„è¡¨è¿°æ˜¯ï¼šmodule å±äºä¸€ä¸ª packageã€‚æˆ‘ä»¬ä¸èƒ½è¯´ï¼Œmodule1 å±äº module2ã€‚æˆ‘ä»¬å‰é¢å·²ç»çœ‹åˆ°ï¼Œmodule çš„è·¯å¾„å®é™…ä¸Šæ˜¯ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œä»å›¾ 14-11 ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ ‘çŠ¶ç»“æ„ä¸­ï¼Œmodule çš„çˆ¶èŠ‚ç‚¹åªèƒ½æ˜¯ packageï¼Œè€Œä¸å¯èƒ½æ˜¯å¦ä¸€ä¸ª moduleã€‚</p></blockquote><h2 id=gil>GIL</h2><p>Python è™šæ‹Ÿæœºä½¿ç”¨ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ï¼ˆGlobal Interpreter Lockï¼ŒGILï¼‰æ¥äº’æ–¥çº¿ç¨‹å¯¹ python è™šæ‹Ÿæœºçš„ä½¿ç”¨ã€‚</p><p>æ³¨æ„è¿™é‡Œ GIL æ˜¯è§£é‡Šå™¨ä¸€çº§çš„äº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨ python è§£é‡Šå™¨ã€‚æ‰€ä»¥<strong>GIL æ˜¯ç”¨æ¥è®©æ“ä½œç³»ç»Ÿä¸­åˆ†é…çš„å¤šä¸ªçº¿ç¨‹äº’æ–¥çš„ä½¿ç”¨ python è§£é‡Šå™¨çš„ï¼Œæ˜¯å»ºç«‹åœ¨ç³»ç»Ÿçº¿ç¨‹è°ƒåº¦åŸºç¡€ä¹‹ä¸Šçš„ä¸€å¥— C API äº’æ–¥æœºåˆ¶</strong>ï¼Œæ˜¯æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹èµ„æºæ›´å¤§ç²’åº¦çš„é”ã€‚</p><p>Python çš„çº¿ç¨‹æ˜¯åŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹çš„ï¼Œæ‰€ä»¥ python çš„çº¿ç¨‹ä¸æ˜¯ã€Œè™šæ‹Ÿå‡ºæ¥çš„ã€ã€‚</p><blockquote><p>é‚£ä¹ˆç©¶ç«Ÿ Python ä¼šåœ¨ä¼—å¤šçš„ç­‰å¾…çº¿ç¨‹ä¸­é€‰æ‹©å“ªä¸€ä¸ªå¹¸è¿å„¿å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸çŸ¥é“ã€‚æ²¡é”™ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒPython å®Œå…¨æ²¡æœ‰æ’æ‰‹ï¼Œè€Œæ˜¯äº¤ç»™äº†åº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥è§£å†³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython å€Ÿç”¨äº†åº•å±‚æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å†³å®šä¸‹ä¸€ä¸ªè¿›å…¥ Python è§£é‡Šå™¨çš„çº¿ç¨‹ç©¶ç«Ÿæ˜¯è°ã€‚</p></blockquote><p>GIL åœ¨ C é‡Œå¯¹åº”çš„ç»“æ„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>[thread_nt.h]
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> NRMUTEX {
</span></span><span style=display:flex><span>    LONG   owned ;
</span></span><span style=display:flex><span>    DWORD  thread_id ;
</span></span><span style=display:flex><span>    HANDLE hevent ;
</span></span><span style=display:flex><span>} NRMUTEX, <span style=color:#f92672>*</span>PNRMUTEX ;
</span></span></code></pre></div><p>å…¶ä¸­<code>owned</code>åˆå§‹åŒ–ä¸º-1ï¼Œè¡¨ç¤ºé”å¯ç”¨ï¼Œå¦åˆ™ä¸ºä¸å¯ç”¨ã€‚<code>thread_id</code>ä»£è¡¨çº¿ç¨‹ idï¼Œæœ€åä¸€ä¸ªæ˜¯å¹³å°ç›¸å…³çš„å˜é‡ï¼Œwin32 ä¸Šæ˜¯ä¸€ä¸ª event å†…æ ¸å¯¹è±¡ã€‚</p><h2 id=å¤šçº¿ç¨‹---æ ‡å‡†è°ƒåº¦>å¤šçº¿ç¨‹ - æ ‡å‡†è°ƒåº¦</h2><blockquote><p>å½“ Python å¯åŠ¨æ—¶ï¼Œæ˜¯å¹¶ä¸æ”¯æŒå¤šçº¿ç¨‹çš„ã€‚æ¢å¥è¯è¯´ï¼ŒPython ä¸­æ”¯æŒå¤šçº¿ç¨‹çš„æ•°æ®ç»“æ„ä»¥åŠ GIL éƒ½æ˜¯æ²¡æœ‰åˆ›å»ºçš„ï¼ŒPython ä¹‹æ‰€ä»¥æœ‰è¿™ç§è¡Œä¸ºæ˜¯å› ä¸ºå¤§å¤šæ•°çš„ Python ç¨‹åºéƒ½ä¸éœ€è¦å¤šçº¿ç¨‹çš„æ”¯æŒ</p></blockquote><p>ä¹¦ä¸­æŒ‡å‡ºï¼Œç”±äº python çš„å¤šçº¿ç¨‹æ ‡å‡†è°ƒåº¦æœºåˆ¶æ˜¯æœ‰ä»£ä»·çš„ï¼Œæ‰€ä»¥é»˜è®¤å•çº¿ç¨‹ä¸åˆå§‹åŒ– GILã€‚</p><ol><li>ä¸»çº¿ç¨‹å¯åŠ¨åï¼Œä¼šç”¨<code>ident = PyThread_start_new_thread(t_bootstrap, (void*) boot);</code>å‡½æ•°è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å£åˆ›å»ºå­çº¿ç¨‹ï¼Œç„¶åä¸»çº¿ç¨‹æŒ‚èµ·ç­‰å¾…<code>obj.done</code>ã€‚æ³¨æ„ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹ä¸­æŒæœ‰ GILã€‚</li><li>ä¸»çº¿ç¨‹ç­‰å¾…çš„è¿™æ®µæ—¶é—´é‡Œï¼Œå­çº¿ç¨‹å°†è‡ªå·±çš„çº¿ç¨‹ id ç­‰ä¿¡æ¯è®¾ç½®å¥½ï¼Œé€šçŸ¥å†…æ ¸å¯¹è±¡<code>obj.done</code>ï¼Œå”¤é†’ç­‰å¾…ä¸­çš„ä¸»çº¿ç¨‹ã€‚æ­¤åˆ»ï¼Œä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹éƒ½åŒæ—¶ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹ä¸€ç›´æŒæœ‰ç€ GILã€‚</li><li>å­çº¿ç¨‹ç»§ç»­æ‰§è¡Œåè¿›å…¥ python è§£é‡Šå™¨ï¼Œå‘ç°éœ€è¦ç­‰å¾…è·å– GILã€‚æ­¤æ—¶å­çº¿ç¨‹ä¸»åŠ¨å°†è‡ªå·±æŒ‚èµ·(è€Œä¸æ˜¯ç”±æ“ä½œç³»ç»ŸæŒ‚èµ·)ã€‚è¿™æ ·å°±è¿›å…¥äº†ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡ GIL è°ƒåº¦çš„é˜¶æ®µã€‚</li><li>ä¸»çº¿ç¨‹è¢«å”¤é†’åï¼Œç»§ç»­æ‰§è¡Œï¼Œç›´åˆ° python å†…ç½®çš„æ—¶é’Ÿè®¡æ—¶å™¨<code>_Py_Ticker</code>ç»“æŸæ‰å°†è‡ªå·±æŒ‚èµ·ï¼Œè®©å‡º GIL(<code>_Py_Ticker</code>ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä¸€æ¡å­—èŠ‚ç åè‡ªåŠ¨å‡ 1ï¼Œåˆå§‹é»˜è®¤ä¸º 100)ã€‚</li></ol><p>é€šè¿‡ä¸Šé¢ 4 æ­¥ï¼Œpython çš„ä¸¤ä¸ªçº¿ç¨‹å°±å®Œæˆäº†ä»ç³»ç»Ÿè°ƒåº¦ä¸Šå‡åˆ° python æ ‡å‡† GIL è°ƒåº¦çš„æµç¨‹ã€‚</p><h2 id=é˜»å¡è°ƒåº¦>é˜»å¡è°ƒåº¦</h2><p>å¦‚åŒä¸Šé¢æµç¨‹ä»‹ç»çš„ï¼Œæ ‡å‡†è°ƒåº¦æ˜¯ python ä½¿ç”¨è½¯ä»¶æ—¶é’Ÿè°ƒåº¦çº¿ç¨‹ï¼Œé‚£ä¹ˆæœ‰æ—¶å€™ python çš„çº¿ç¨‹ä¼šè‡ªæˆ‘é˜»å¡ï¼Œæ¯”å¦‚<code>raw_input()</code>ã€<code>sleep()</code>ç­‰å‡½æ•°ï¼Œè¿™æ—¶ python å°±ä¼šä½¿ç”¨é˜»å¡è°ƒåº¦çš„æ–¹å¼ã€‚</p><ol><li>ä¸»çº¿ç¨‹è°ƒç”¨<code>sleep(1)</code>åï¼Œè°ƒç”¨<code>Py_BEGIN_ALLOW_THREADS</code>ç«‹åˆ»é‡Šæ”¾ GILï¼Œç„¶åè°ƒç”¨æ“ä½œç³»ç»Ÿçš„ sleep æ“ä½œã€‚æ­¤æ—¶ä¸»çº¿ç¨‹å°±ç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ã€‚</li><li>å­çº¿ç¨‹æ‹¿åˆ° GILã€‚æ­¤æ—¶ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹åŒæ—¶å¯è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦ã€‚æ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œä¸€æ®µæ—¶é—´å­çº¿ç¨‹åä¼šæŒ‚èµ·ï¼Œè°ƒåº¦ä¸»çº¿ç¨‹ï¼Œå‘ç°ä¸»çº¿ç¨‹ sleep æ²¡ç»“æŸå°±æŒ‚èµ·ä¸»çº¿ç¨‹ï¼Œå°±ç»§ç»­å”¤é†’å­çº¿ç¨‹æ‰§è¡Œã€‚</li><li>å½“ä¸»çº¿ç¨‹ sleep ç»“æŸï¼Œæ“ä½œç³»ç»Ÿå”¤é†’ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹è°ƒç”¨<code>Py_END_ALLOW_THREADS</code>å†æ¬¡ç”³è¯· GILï¼Œé‡æ–°è¿›å…¥ python æ ‡å‡†è°ƒåº¦æµç¨‹ã€‚</li></ol><p><strong>å¯è§ python åœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‰æä¸‹ï¼Œå…è®¸çº¿ç¨‹åœ¨æŸäº›æ—¶åˆ»è„±ç¦» GIL æ ‡å‡†è°ƒåº¦æµç¨‹ã€‚</strong></p><p>å…¶ä¸­<code>Py_BEGIN_ALLOW_THREADS</code>å’Œ<code>Py_END_ALLOW_THREADS</code>ä¸¤ä¸ªè´Ÿè´£é‡Šæ”¾å’Œç­‰å¾… GIL çš„å®çš„å®ç°å¦‚ä¸‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>[ceval.h]
</span></span><span style=display:flex><span><span style=color:#75715e>#define Py_BEGIN_ALLOW_THREADS { \
</span></span></span><span style=display:flex><span><span style=color:#75715e>            PyThreadState *_save; \
</span></span></span><span style=display:flex><span><span style=color:#75715e>            _save = PyEval_SaveThread();
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define Py_END_ALLOW_THREADS    PyEval_RestoreThread(_save); \
</span></span></span><span style=display:flex><span><span style=color:#75715e>         }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>[ceval.c]
</span></span><span style=display:flex><span>PyThreadState<span style=color:#f92672>*</span> <span style=color:#a6e22e>PyEval_SaveThread</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    PyThreadState <span style=color:#f92672>*</span>tstate <span style=color:#f92672>=</span> <span style=color:#a6e22e>PyThreadState_Swap</span>(NULL);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (interpreter_lock)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PyThread_release_lock</span>(interpreter_lock);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> tstate;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>PyEval_RestoreThread</span>(PyThreadState <span style=color:#f92672>*</span>tstate)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (interpreter_lock) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> err <span style=color:#f92672>=</span> errno;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PyThread_acquire_lock</span>(interpreter_lock, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        errno <span style=color:#f92672>=</span> err;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>PyThreadState_Swap</span>(tstate);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ç”¨æˆ·çº§äº’æ–¥>ç”¨æˆ·çº§äº’æ–¥</h2><p>ç”¨æˆ·çº§çš„äº’æ–¥é”åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥æœºåˆ¶å®ç°ï¼ŒåŒæ—¶è¦è€ƒè™‘é˜²æ­¢å’Œ GIL å½¢æˆæ­»é”ã€‚æ‰€ä»¥è¿‡ç¨‹ä¸é˜»å¡è°ƒåº¦ç±»ä¼¼éœ€è¦ä½¿ç”¨<code>Py_BEGIN_ALLOW_THREADS</code>å’Œ<code>Py_END_ALLOW_THREADS</code>è¿™ä¸¤ä¸ªå®ã€‚</p><ol><li>çº¿ç¨‹ a è°ƒç”¨ lock å¯¹è±¡åŠ é”ï¼Œlock å¯¹è±¡å†…éƒ¨è°ƒç”¨ç³»ç»Ÿäº’æ–¥æœºåˆ¶ï¼ŒåŒæ—¶æ‰§è¡Œ<code>Py_BEGIN_ALLOW_THREADS</code>é‡Šæ”¾ GIL é˜²æ­¢æ­»é”ã€‚</li><li>çº¿ç¨‹ b è·å¾— GILï¼Œæ‰§è¡Œåˆ°æŸå¤„é‡Šæ”¾é”ï¼Œlock å¯¹è±¡å†…éƒ¨è°ƒç”¨ç³»ç»Ÿæœºåˆ¶é‡Šæ”¾é”ï¼ŒåŒæ—¶åº•å±‚è°ƒç”¨äº†<code>Py_END_ALLOW_THREADS</code>ç­‰å¾… GILã€‚</li><li>çº¿ç¨‹ a è¢«ç³»ç»Ÿå”¤é†’ï¼Œè·å– GILï¼Œä¸€æ°”å‘µæˆã€‚</li></ol><h2 id=å­çº¿ç¨‹çš„é”€æ¯>å­çº¿ç¨‹çš„é”€æ¯</h2><blockquote><p>åœ¨çº¿ç¨‹çš„å…¨éƒ¨è®¡ç®—å®Œæˆä¹‹åï¼ŒPython å°†é”€æ¯çº¿ç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPython ä¸»çº¿ç¨‹çš„é”€æ¯ä¸å­çº¿ç¨‹çš„é”€æ¯æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºä¸»çº¿ç¨‹çš„é”€æ¯åŠ¨ä½œå¿…é¡»è¦é”€æ¯ Python çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œè€Œå­çº¿ç¨‹çš„é”€æ¯åˆ™ä¸éœ€è¦è¿›è¡Œè¿™äº›åŠ¨ä½œã€‚</p></blockquote><h2 id=å†…å­˜ç®¡ç†>å†…å­˜ç®¡ç†</h2><p>å¤§å—å†…å­˜ç®¡ç†ç›´æ¥è°ƒç”¨ C çš„ malloc å’Œ free æ¥å£ï¼Œå°å—å†…å­˜åˆ†é…åˆ™ç”± python çš„å†…å­˜æ± ç®¡ç†æœºåˆ¶è°ƒåº¦ã€‚</p><h3 id=å°å—å†…å­˜ç®¡ç†çš„å¯¹è±¡>å°å—å†…å­˜ç®¡ç†çš„å¯¹è±¡</h3><p>Python çš„å†…å­˜å—å« blockï¼Œæ¯ä¸ª block å¤§å°ä¸åŒï¼Œéƒ½æ˜¯ 8 çš„æ•´æ•°å€ã€‚ç®¡ç† block çš„å« poolï¼Œä¸€ä¸ª pool æ˜¯ 4Kã€‚pool ç®¡ç†<strong>ç›¸åŒå¤§å°</strong>çš„ä¸€å † blockã€‚pool å¯¹è±¡çš„ szindex å˜é‡ä¿å­˜äº†è¿™ä¸ª pool å¯¹åº”çš„ block å¤§å°ã€‚</p><blockquote><p>ï¼Œä¸€ä¸ª pool å¯èƒ½ç®¡ç†äº† 100 ä¸ª 32 ä¸ªå­—èŠ‚çš„ blockï¼Œä¹Ÿå¯èƒ½ç®¡ç†äº† 100 ä¸ª 64 ä¸ªå­—èŠ‚çš„ blockï¼Œä½†æ˜¯ç»ä¸ä¼šæœ‰ä¸€ä¸ªç®¡ç†äº† 50 ä¸ª 32 å­—èŠ‚çš„ block å’Œ 50 ä¸ª 64 å­—èŠ‚çš„ block çš„ pool å­˜åœ¨</p></blockquote><p>Python å¯¹äºå†…å­˜å—çš„ç®¡ç†ç±»ä¼¼å¯¹è±¡çš„ç­–ç•¥ï¼Œæ¯æ¬¡å†…å­˜åˆ†é…ä¸€æ•´ä¸ª blockï¼Œå›æ”¶æ—¶å…ˆå°†ä¸ç”¨çš„ Block åŠ å…¥é—²ç½®çš„é˜Ÿåˆ—é‡Œç­‰å¾…é‡æ–°åˆ©ç”¨ï¼Œä¸æ˜¯ç›´æ¥å›æ”¶ã€‚(æƒ°æ€§å›æ”¶ç­–ç•¥)</p><p>ç®¡ç†å¤šä¸ª pool çš„æ•°æ®å¯¹è±¡æ˜¯ arenaã€‚ä¸‹å›¾å¯è§ï¼Œpool ç»“æ„æ˜¯ä¸€æ¬¡æ€§åˆ†é…å¥½ä¸€å—å†…å­˜ï¼Œè€Œ arena åˆ™æ˜¯é€šè¿‡æŒ‡é’ˆè¿å‘ä¸€å— poolã€‚</p><p><img src=https://i.loli.net/2021/03/05/2duvofnkP9LEO8x.jpg alt></p><p>è€Œ python ç»´æŠ¤ä¸€ä¸ªåå« arenas çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ å°±æ˜¯ arena å¯¹è±¡ã€‚arena ä¹‹é—´é€šè¿‡ç”±ä¸¤æ¡é“¾è¡¨ç›¸è¿ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul><li><em>unused_arena_objects</em> æ˜¯å•å‘é‡è¡¨ï¼ŒæŒ‡å‘æœªåˆ†é… pool çš„ arena</li><li><em>usable_arenas</em> æ˜¯åŒå‘é“¾è¡¨ï¼Œè¡¨ç¤ºå·²ç»åˆ†é…äº† pool çš„ arena</li></ul><p><img src=https://i.loli.net/2021/03/05/duFq5I6lWACjQyw.jpg alt></p><blockquote><p>å½“ä¸€ä¸ª arena çš„ area_object æ²¡æœ‰ä¸ pool é›†åˆå»ºç«‹è”ç³»æ—¶ï¼Œè¿™æ—¶çš„ arena å¤„äºâ€œæœªä½¿ç”¨â€çŠ¶æ€ï¼›ä¸€æ—¦å»ºç«‹äº†è”ç³»ï¼Œè¿™æ—¶ arena å°±è½¬æ¢åˆ°äº†â€œå¯ç”¨â€çŠ¶æ€ã€‚å¯¹äºæ¯ä¸€ç§çŠ¶æ€ï¼Œéƒ½æœ‰ä¸€ä¸ª arena çš„é“¾è¡¨ã€‚â€œæœªä½¿ç”¨â€çš„ arena çš„é“¾è¡¨è¡¨å¤´æ˜¯ unused_arena_objectsã€arena ä¸ arena ä¹‹é—´é€šè¿‡ nextarena è¿æ¥ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼›è€Œâ€œå¯ç”¨â€çš„ arena çš„é“¾è¡¨è¡¨å¤´æ˜¯ usable_arenasã€arena ä¸ arena ä¹‹é—´é€šè¿‡ nextarena å’Œ prevarena è¿æ¥ï¼Œæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</p></blockquote><p><strong>Pool æ˜¯ python ç®¡ç†å†…å­˜çš„å¯¹è±¡ï¼Œarena è™½ç„¶æ›´ä¸Šå±‚ï¼Œä½†æ˜¯ arena å†…çš„ pool é›†åˆå¯èƒ½ç®¡ç† 32 å­—èŠ‚çš„ blockï¼Œä¹Ÿå¯èƒ½ç®¡ç† 64 å­—èŠ‚çš„ blockï¼Œæ‰€ä»¥ arena æ— æ³•å†³å®šé”€æ¯å’Œåˆ†é…å†…å­˜ã€‚Python ä»ç„¶ä»¥ pool ä¸ºå•ä½ç®¡ç†å†…å­˜å¼€é”€ã€‚(pool æœ‰ size æ¦‚å¿µï¼Œarena æ²¡æœ‰ size æ¦‚å¿µ)</strong></p><p>Pool æœ‰ä¸‰ç§çŠ¶æ€ fullã€empty å’Œ usedã€‚å…¶ä¸­ full ä¸éœ€è¦è¿æ¥èµ·æ¥ï¼Œå…¶ä»–ä¸¤ç§çŠ¶æ€ä¼šè¢« freepools å’Œ usedpools è¿æ¥èµ·æ¥æ–¹ä¾¿ç®¡ç†ã€‚</p><p><img src=https://i.loli.net/2021/03/05/mZr1P7ocQYbpCFB.jpg alt></p><h3 id=arena-çš„åˆ†é…>arena çš„åˆ†é…</h3><p>arena å¯ä»¥æŒ‡å‘ 32 ä½ pool é›†åˆï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ 64 ä½ pool é›†åˆã€‚åˆ†é…å†…å­˜çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å…ˆåœ¨ usable_arenas é“¾è¡¨ä¸Šæ‰¾å¯ç”¨çš„ arenaï¼Œç„¶åæ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ pool</li><li>å¦‚æœæ²¡æœ‰å¯ç”¨çš„ arenaï¼Œåˆ™ä» arenas æ•°ç»„é‡Œæ‘˜ä¸‹æ¥æ–°çš„ arenaï¼Œæ”¾åœ¨ usable_arenas é‡Œï¼Œç„¶ååˆå§‹åŒ– pool</li><li>ä» usedpools é“¾è¡¨é‡Œæ‰¾å¯ç”¨çš„ blocks</li><li>usedpools æ²¡æœ‰å¯ç”¨çš„ poolï¼Œå°±ä» freepools é“¾è¡¨åˆ†é…ä¸€ä¸ª empty çŠ¶æ€çš„ pool</li></ol><h3 id=python-ç¼–è¯‘æ—¶æŒ‡å®šå†…å­˜ä¸Šé™>Python ç¼–è¯‘æ—¶æŒ‡å®šå†…å­˜ä¸Šé™</h3><blockquote><p>å½“ Python åœ¨ WITH_MEMORY_LIMITS ç¼–è¯‘ç¬¦å·æ‰“å¼€çš„èƒŒæ™¯ä¸‹è¿›è¡Œç¼–è¯‘æ—¶ï¼ŒPython å†…éƒ¨çš„å¦ä¸€ä¸ªç¬¦å·ä¼šè¢«æ¿€æ´»ï¼Œè¿™ä¸ªåä¸º SMALL_MEMORY_LIMIT çš„ç¬¦å·é™åˆ¶äº†æ•´ä¸ªå†…å­˜æ± çš„å¤§å°ï¼ŒåŒæ—¶ï¼Œä¹Ÿå°±é™åˆ¶äº†å¯ä»¥åˆ›å»ºçš„ arena çš„ä¸ªæ•°ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸è®ºæ˜¯ Win32 å¹³å°ï¼Œè¿˜æ˜¯ unix å¹³å°ï¼Œè¿™ä¸ªç¼–è¯‘ç¬¦å·éƒ½æ˜¯æ²¡æœ‰æ‰“å¼€çš„ï¼Œæ‰€ä»¥é€šå¸¸ Python éƒ½æ²¡æœ‰å¯¹å°å—å†…å­˜çš„å†…å­˜æ± çš„å¤§å°åšä»»ä½•çš„é™åˆ¶ã€‚</p></blockquote><h3 id=å°å—å†…å­˜ç®¡ç†çš„æµç¨‹>å°å—å†…å­˜ç®¡ç†çš„æµç¨‹</h3><p><em>(æ­¤éƒ¨åˆ†æ‘˜è‡ªä¹¦ä¸­ä»£ç æ³¨é‡Š)</em></p><ol><li>å¦‚æœç”³è¯·çš„å†…å­˜å°äº SMALL_REQUEST_THRESHOLDï¼Œä½¿ç”¨ Python çš„å°å—å†…å­˜çš„å†…å­˜æ± ã€‚å¦åˆ™ï¼Œè½¬å‘ malloc</li><li>æ ¹æ®ç”³è¯·å†…å­˜çš„å¤§å°è·å¾—å¯¹åº”çš„ size class index</li><li>å¦‚æœ usedpools ä¸­å¯ç”¨çš„ poolï¼Œä½¿ç”¨è¿™ä¸ª pool æ¥åˆ†é… block</li><li>åˆ†é…ç»“æŸåï¼Œå¦‚æœ pool ä¸­çš„ block éƒ½è¢«åˆ†é…äº†ï¼Œå°† pool ä» usedpools ä¸­æ‘˜é™¤</li><li>å¦‚æœ usedpools ä¸­æ²¡æœ‰å¯ç”¨çš„ poolï¼Œä» usable_arenas ä¸­è·å– pool</li><li>å¦‚æœ usable_arenas ä¸­æ²¡æœ‰å°±â€œå¯ç”¨â€çš„ arenaï¼Œå¼€å§‹ç”³è¯· arena</li><li>ä» usable_arenas çš„ç¬¬ä¸€ä¸ª arena ä¸­è·å–ä¸€ä¸ª pool</li><li>è·å– pool æˆåŠŸï¼Œè¿›è¡Œ init pool çš„åŠ¨ä½œï¼Œå°† pool æ”¾å…¥ used_pools ä¸­ï¼Œå¹¶è¿”å›åˆ†é…å¾—åˆ°çš„ block</li><li>è·å– pool å¤±è´¥ï¼Œå¯¹ arena ä¸­çš„ pool é›†åˆè¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åè½¬å…¥ goto åˆ° init pool çš„åŠ¨ä½œå¤„ï¼Œåˆå§‹åŒ–ä¸€ä¸ªç‰¹å®šçš„ pool</li></ol><h3 id=python-25-å¯¹å¤šæ¬¡åˆ†é…å°å†…å­˜é€ æˆå†…å­˜æ³„æ¼çš„å¤„ç†>Python 2.5 å¯¹å¤šæ¬¡åˆ†é…å°å†…å­˜é€ æˆå†…å­˜æ³„æ¼çš„å¤„ç†</h3><p>åœ¨ 2.5 ä¹‹å‰ç‰ˆæœ¬ï¼ŒPython çš„ arena ä»æ¥ä¸é‡Šæ”¾ poolã€‚è¿™å°±é€ æˆåå¤åˆ†é…å°å†…å­˜åé€ æˆçš„ arena å¤ªå¤šè€Œå†…å­˜æ— æ³•å›æ”¶ã€‚</p><p>2.5 ä¹‹åçš„å¤„ç†åŠæ³•ï¼šarena æœ‰ä¸¤ç§çŠ¶æ€ï¼Œunused å’Œ usableã€‚ä¸Šæ–‡å·²ç»ä»‹ç»è¿‡ã€‚</p><ol><li>å¦‚æœ arena ä¸­æ‰€æœ‰çš„ pool éƒ½æ˜¯ empty çš„ï¼Œé‡Šæ”¾ pool é›†åˆå ç”¨çš„å†…å­˜ã€‚arena å˜æˆ unused çŠ¶æ€ï¼Œä» usable_arenas å‰”é™¤</li><li>å¦‚æœ arena åˆå§‹åŒ–äº†æ–°çš„ poolï¼Œarena å˜æˆ usable çŠ¶æ€ï¼Œä» usable_arenas é“¾è¡¨ä¸­é¡ºåºæŸ¥æ‰¾ä½ç½®æ’å…¥è¯¥ arenaã€‚æ³¨æ„ï¼Œusable_arenas æ˜¯æœ‰åºé“¾è¡¨(æŒ‰ç…§ arena ä¸­ pool çš„ä¸ªæ•°æ’åºï¼Œpool å¤šçš„ arena æ’å‰è¾¹ï¼Œpool å°‘çš„æ’åè¾¹)</li><li>è¿™æ ·ï¼Œå†æœ‰åˆ†é…å†…å­˜çš„è¯·æ±‚æ—¶ï¼Œå…ˆä» usable_arenas è¡¨å¤´é¡ºåºæŸ¥ï¼Œæ’åœ¨å‰è¾¹ pool å¤šçš„ arena å°±è¢«åˆ©ç”¨çš„å……åˆ†ï¼Œpool å°‘çš„ arena å°±æ›´æœ‰å¯èƒ½å˜æˆ unused çŠ¶æ€ï¼Œå®¹æ˜“è¢«é‡Šæ”¾æ‰ã€‚è¾¾åˆ°èŠ‚çœå†…å­˜çš„ç›®çš„</li></ol><h3 id=å†…å­˜æ± å…¨æ™¯>å†…å­˜æ± å…¨æ™¯</h3><p><img src=https://i.loli.net/2021/03/05/1Lh6u4awv8ZyQ9H.jpg alt></p><h2 id=python-åƒåœ¾å›æ”¶æœºåˆ¶>Python åƒåœ¾å›æ”¶æœºåˆ¶</h2><p>é™¤äº†è®¡æ•°å™¨ï¼Œpython è¿˜æ˜¯ä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤ï¼Œåˆ†ä»£å›æ”¶æœºåˆ¶ã€‚</p><h3 id=æ ‡è®°---æ¸…é™¤>æ ‡è®° - æ¸…é™¤</h3><h4 id=ä¸‰è‰²æ¨¡å‹>ä¸‰è‰²æ¨¡å‹</h4><p>æ ¹æ®ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨æƒ…å†µå»ºç«‹æœ‰å‘å›¾ï¼Œæ²¿ç€æœ‰å‘å›¾ä»æ ¹å¼€å§‹çš„é€å±‚æŸ“è‰²ï¼Œé»‘è‰²ä»£è¡¨è¯¥èŠ‚ç‚¹æ‰€æœ‰å¼•ç”¨éƒ½æ£€æŸ¥è¿‡äº†ï¼Œç°è‰²è¡¨ç¤ºèŠ‚ç‚¹æ˜¯å¯è¾¾çš„ï¼Œå½“æ‰€æœ‰ç°è‰²èŠ‚ç‚¹éƒ½å˜ä¸ºé»‘è‰²ï¼Œæ£€æŸ¥ç»“æŸã€‚</p><p><img src=https://i.loli.net/2021/03/05/2a1kYDnyT4fBQxP.jpg alt></p><h3 id=python-ä¸­çš„æ ‡è®°æ¸…é™¤>Python ä¸­çš„æ ‡è®°æ¸…é™¤</h3><p>Python çš„å¯¹è±¡ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼ŒPyGC_Headï¼ŒPyObject_Head å’Œæœ¬ä½“ã€‚å…¶ä¸­ PyObject_Head é‡Œå­˜è®¡æ•°å™¨ç”¨æ¥æ ‡è®°å½“å‰èŠ‚ç‚¹æ˜¯å¦å¯å›æ”¶ï¼Œä½†æ˜¯å¯¹äºå¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œå°±éœ€è¦ PyGC_Head é‡Œçš„ refsï¼Œpython ä¼šæ ¹æ®ä¸€äº›è§¦å‘æ¡ä»¶è¿›è¡Œä¸‰è‰²æ¨¡å‹çš„æ ‡è®°ï¼ŒæŸä¸ªå¯¹è±¡çš„ã€Œå¯è¾¾æ¬¡æ•°ã€æ ‡è®°åœ¨ PyGC_Head é‡Œï¼Œå½“è¿™ä¸ªå¯è¾¾æ¬¡æ•°ä¸º 0 æ—¶ï¼Œä»£è¡¨å¯¹è±¡ä¸å¯è¾¾ï¼Œä¹Ÿå°±éœ€è¦å›æ”¶ä¹‹ã€‚PyGC_Head ä¹‹é—´æœ‰ä¸€æ¡åŒå‘é“¾è¡¨è¿æ¥äº†æ‰€æœ‰å¯¹è±¡ï¼Œå°†ä»–ä»¬çº³å…¥å†…å­˜å›æ”¶ç®¡ç†ç³»ç»Ÿé‡Œã€‚</p><p><img src=https://i.loli.net/2021/03/05/UT5ry697VXINBQp.jpg alt></p><h4 id=æµç¨‹>æµç¨‹</h4><ol><li>åœ¨åƒåœ¾æ”¶é›†çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯éå†å¯æ”¶é›†å¯¹è±¡é“¾è¡¨ï¼Œå°†æ¯ä¸ªå¯¹è±¡çš„ gc.gc_ref å€¼è®¾ç½®ä¸ºå…¶ ob_refcnt å€¼ã€‚</li><li>æ¥ä¸‹æ¥çš„åŠ¨ä½œå°±æ˜¯è¦å°†ç¯å¼•ç”¨ä»å¼•ç”¨ä¸­æ‘˜é™¤ã€‚</li><li>æœ‰ä¸€äº› container å¯¹è±¡çš„<code>PyGC_Head.gc.gc_ref</code>è¿˜ä¸ä¸º 0ï¼Œè¿™å°±æ„å‘³ç€å­˜åœ¨å¯¹è¿™äº›å¯¹è±¡çš„å¤–éƒ¨å¼•ç”¨ï¼Œè¿™äº›å¯¹è±¡ï¼Œå°±æ˜¯å¼€å§‹æ ‡è®° - æ¸…é™¤ç®—æ³•çš„ root object é›†åˆã€‚</li></ol><h3 id=åˆ†ä»£å›æ”¶>åˆ†ä»£å›æ”¶</h3><blockquote><p>è¿™ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ€»ä½“æ€æƒ³æ˜¯ï¼šå°†ç³»ç»Ÿä¸­çš„æ‰€æœ‰å†…å­˜å—æ ¹æ®å…¶å­˜æ´»æ—¶é—´åˆ’åˆ†ä¸ºä¸åŒçš„é›†åˆï¼Œæ¯ä¸€ä¸ªé›†åˆå°±ç§°ä¸ºä¸€ä¸ªâ€œä»£â€ï¼Œåƒåœ¾æ”¶é›†çš„é¢‘ç‡éšç€â€œä»£â€çš„å­˜æ´»æ—¶é—´çš„å¢å¤§è€Œå‡å°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ´»å¾—è¶Šé•¿çš„å¯¹è±¡ï¼Œå°±è¶Šå¯èƒ½ä¸æ˜¯åƒåœ¾ï¼Œå°±åº”è¯¥è¶Šå°‘å»æ”¶é›†ã€‚</p></blockquote><p><img src=https://i.loli.net/2021/03/05/mQuPrwyD73ZjhBv.jpg alt></p><blockquote><p>Python é‡‡ç”¨äº†ä¸‰ä»£çš„åˆ†ä»£æ”¶é›†æœºåˆ¶ï¼Œå¦‚æœå½“å‰æ”¶é›†çš„æ˜¯ç¬¬ 1 ä»£ï¼Œé‚£ä¹ˆåœ¨å¼€å§‹åƒåœ¾æ”¶é›†ä¹‹å‰ï¼ŒPython ä¼šå°†æ¯”å…¶â€œå¹´è½»â€çš„æ‰€æœ‰ä»£çš„å†…å­˜é“¾è¡¨ï¼ˆå½“ç„¶ï¼Œåœ¨è¿™é‡Œåªæœ‰ç¬¬ 0 ä»£ï¼‰æ•´ä¸ªåœ°é“¾æ¥åˆ°ç¬¬ 1 ä»£å†…å­˜é“¾è¡¨ä¹‹åï¼Œè¿™ä¸ªæ“ä½œæ˜¯é€šè¿‡ gc_list_merge å®ç°çš„ã€‚</p></blockquote><h3 id=æ€»ç»“>æ€»ç»“</h3><ol><li>å°†æ¯”å½“å‰å¤„ç†çš„â€œä»£â€æ›´å¹´è½»çš„â€œä»£â€çš„é“¾è¡¨åˆå¹¶åˆ°å½“å‰â€œä»£â€ä¸­</li><li>åœ¨å¾…å¤„ç†é“¾è¡¨ä¸Šè¿›è¡Œæ‰“ç ´å¾ªç¯çš„æ¨¡æ‹Ÿï¼Œå¯»æ‰¾ root object</li><li>å°†å¾…å¤„ç†é“¾è¡¨ä¸­çš„ unreachable object è½¬ç§»åˆ° unreachable é“¾è¡¨ä¸­ï¼Œå¤„ç†å®Œæˆåï¼Œå½“å‰â€œä»£â€ä¸­åªå‰©ä¸‹ reachable object äº†</li><li>å¦‚æœå¯èƒ½ï¼Œå°†å½“å‰â€œä»£â€ä¸­çš„ reachable object åˆå¹¶åˆ°æ›´è€çš„â€œä»£â€ä¸­</li><li>å¯¹äº unreachable é“¾è¡¨ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœå…¶å¸¦æœ‰<code>__del__</code>å‡½æ•°ï¼Œåˆ™ä¸èƒ½å®‰å…¨å›æ”¶ï¼Œéœ€è¦å°†è¿™äº›å¯¹è±¡æ”¶é›†åˆ° finalizers é“¾è¡¨ä¸­ï¼Œå› æ­¤ï¼Œè¿™äº›å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ä¹Ÿä¸èƒ½å›æ”¶,ä¹Ÿéœ€è¦æ”¾å…¥ finalizers é“¾è¡¨ä¸­</li><li>å¤„ç†å¼±å¼•ç”¨ï¼ˆweakrefï¼‰ï¼Œå¦‚æœå¯èƒ½ï¼Œè°ƒç”¨å¼±å¼•ç”¨ä¸­æ³¨å†Œçš„ callback æ“ä½œ</li><li>å¯¹ unreachable é“¾è¡¨ä¸Šçš„å¯¹è±¡è¿›è¡Œåƒåœ¾å›æ”¶æ“ä½œ</li><li>å°†å«æœ‰<code>__del__</code>æ“ä½œçš„å®ä¾‹å¯¹è±¡æ”¶é›†åˆ° Python å†…éƒ¨ç»´æŠ¤çš„åä¸º garbage çš„é“¾è¡¨ä¸­ï¼ŒåŒæ—¶å°† finalizers é“¾è¡¨ä¸­æ‰€æœ‰å¯¹è±¡åŠ å…¥ old é“¾è¡¨ä¸­</li></ol><p><strong>æ³¨æ„ï¼Œå¦‚æœå¯¹è±¡æ‹¥æœ‰<code>__del__</code>æ–¹æ³•ï¼Œå°±ä¸èƒ½é€šè¿‡åƒåœ¾å›æ”¶æ¥è‡ªåŠ¨å›æ”¶</strong>ï¼Œæ‰€ä»¥è¦æ…é‡ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p></content><p><a href=https://sund.site/tags/python/>#Python</a></p><div class=toc><nav id=TableOfContents><ul><li><a href=#python-ç¯å¢ƒåˆå§‹åŒ–>Python ç¯å¢ƒåˆå§‹åŒ–</a></li><li><a href=#python-çš„-import-æœºåˆ¶>Python çš„ import æœºåˆ¶</a></li><li><a href=#gil>GIL</a></li><li><a href=#å¤šçº¿ç¨‹---æ ‡å‡†è°ƒåº¦>å¤šçº¿ç¨‹ - æ ‡å‡†è°ƒåº¦</a></li><li><a href=#é˜»å¡è°ƒåº¦>é˜»å¡è°ƒåº¦</a></li><li><a href=#ç”¨æˆ·çº§äº’æ–¥>ç”¨æˆ·çº§äº’æ–¥</a></li><li><a href=#å­çº¿ç¨‹çš„é”€æ¯>å­çº¿ç¨‹çš„é”€æ¯</a></li><li><a href=#å†…å­˜ç®¡ç†>å†…å­˜ç®¡ç†</a><ul><li><a href=#å°å—å†…å­˜ç®¡ç†çš„å¯¹è±¡>å°å—å†…å­˜ç®¡ç†çš„å¯¹è±¡</a></li><li><a href=#arena-çš„åˆ†é…>arena çš„åˆ†é…</a></li><li><a href=#python-ç¼–è¯‘æ—¶æŒ‡å®šå†…å­˜ä¸Šé™>Python ç¼–è¯‘æ—¶æŒ‡å®šå†…å­˜ä¸Šé™</a></li><li><a href=#å°å—å†…å­˜ç®¡ç†çš„æµç¨‹>å°å—å†…å­˜ç®¡ç†çš„æµç¨‹</a></li><li><a href=#python-25-å¯¹å¤šæ¬¡åˆ†é…å°å†…å­˜é€ æˆå†…å­˜æ³„æ¼çš„å¤„ç†>Python 2.5 å¯¹å¤šæ¬¡åˆ†é…å°å†…å­˜é€ æˆå†…å­˜æ³„æ¼çš„å¤„ç†</a></li><li><a href=#å†…å­˜æ± å…¨æ™¯>å†…å­˜æ± å…¨æ™¯</a></li></ul></li><li><a href=#python-åƒåœ¾å›æ”¶æœºåˆ¶>Python åƒåœ¾å›æ”¶æœºåˆ¶</a><ul><li><a href=#æ ‡è®°---æ¸…é™¤>æ ‡è®° - æ¸…é™¤</a><ul><li><a href=#ä¸‰è‰²æ¨¡å‹>ä¸‰è‰²æ¨¡å‹</a></li></ul></li><li><a href=#python-ä¸­çš„æ ‡è®°æ¸…é™¤>Python ä¸­çš„æ ‡è®°æ¸…é™¤</a><ul><li><a href=#æµç¨‹>æµç¨‹</a></li></ul></li><li><a href=#åˆ†ä»£å›æ”¶>åˆ†ä»£å›æ”¶</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></li></ul></nav></div></main><footer>Subscribe via <a href=/index.xml>RSS</a>.<br>Made with
<a href=https://github.com/rokcso/hugo-bearblog-neo/>Hugo Bear Neo</a>.<br>Copyright Â© 2013-2025, Steve Sun.
ğŸ—ºï¸ <a href=/sitemap.xml>Sitemap</a>.</footer></body></html>