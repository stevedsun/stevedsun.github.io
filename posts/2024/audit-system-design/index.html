<!doctype html><html lang=zh-CN><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://sund.site/favicon.ico><title>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¬¦åˆå·¥ä¸šæ ‡å‡†çš„å®¡è®¡ç³»ç»Ÿ | Steve Sun</title>
<meta name=title content="å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¬¦åˆå·¥ä¸šæ ‡å‡†çš„å®¡è®¡ç³»ç»Ÿ"><meta name=description content="å®¡è®¡è¿½è¸ªï¼ˆAudit Trailï¼‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿä¸­ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€æ§åˆ¶ç»„ä»¶çš„æ´»åŠ¨æ—¥å¿—ç­‰å…³é”®å®‰å…¨ä¿¡æ¯çš„æœåŠ¡ã€‚æ—¥å¿—é€šå¸¸ä»¥æ—¶é—´é¡ºåºæ’åˆ—ï¼Œè®°å½•äº†â€œè°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆâ€ã€‚
ä¸‹é¢æ˜¯ kubernetes å®˜æ–¹æ–‡æ¡£å¯¹å…¶å®¡è®¡æœåŠ¡çš„æè¿°ï¼š

Kubernetes å®¡è®¡ï¼ˆAuditingï¼‰ åŠŸèƒ½æä¾›äº†ä¸å®‰å…¨ç›¸å…³çš„ã€æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è®°å½•é›†ï¼Œè®°å½•æ¯ä¸ªç”¨æˆ·ã€ä½¿ç”¨ Kubernetes API çš„åº”ç”¨ä»¥åŠæ§åˆ¶é¢è‡ªèº«å¼•å‘çš„æ´»åŠ¨ã€‚
å®¡è®¡åŠŸèƒ½ä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š

å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ï¼Ÿ
è°è§¦å‘çš„ï¼Ÿ
æ´»åŠ¨å‘ç”Ÿåœ¨å“ªä¸ªï¼ˆäº›ï¼‰å¯¹è±¡ä¸Šï¼Ÿ
åœ¨å“ªè§‚å¯Ÿåˆ°çš„ï¼Ÿ
å®ƒä»å“ªè§¦å‘çš„ï¼Ÿ
æ´»åŠ¨çš„åç»­å¤„ç†è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿ


å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ

æ—¥å¿—å†…å®¹ä¸å¯ç¯¡æ”¹ã€‚
æ—¥å¿—é“¾ç»“æ„å®Œæ•´ï¼šä¸å¯ä»»æ„æ·»åŠ æˆ–åˆ é™¤å•ç‹¬çš„æ—¥å¿—æ¡ç›®ã€‚
å…¼å®¹æ€§ï¼šå‘é€æ—¥å¿—çš„å®¢æˆ·ç«¯åº”è¯¥é¿å…ä¾µå…¥å¼è®¾è®¡ã€‚
ç³»ç»Ÿçš„åŠ å¯†æœåŠ¡åº”è¯¥å°½æ—©åˆå§‹åŒ–ï¼Œä»¥å‡å°‘æœªå—ä¿æŠ¤çš„æ—¥å¿—ã€‚
æœåŠ¡é‡å¯/å…³é—­ä¸åº”å¯¼è‡´å®¡æ ¸æ—¥å¿—ä¸ä¸€è‡´ã€‚å¦‚æœæœåŠ¡å› ç´§æ€¥æƒ…å†µè€Œå…³é—­ï¼Œå®¡è®¡æ—¥å¿—åº”è¯¥æ˜¯å¯éªŒè¯çš„ã€‚
å¯†é’¥å®‰å…¨æ€§ï¼šåŠ å¯†å¯†é’¥ï¼ˆç”¨äºè®¡ç®—å®Œæ•´æ€§æ£€æŸ¥ï¼‰åº”å­˜å‚¨åœ¨ä¸“ç”¨å¯†é’¥å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­é©»ç•™æœ€çŸ­çš„æ—¶é—´ã€‚
æ€§èƒ½ï¼šèƒ½å¤Ÿåœ¨å‡ ç§’é’Ÿå†…éªŒè¯å—ä¿æŠ¤æ—¥å¿—ã€‚
æ—¥å¿—è½®æ¢å‹å¥½æ€§ï¼šå®¡æ ¸æ—¥å¿—åº”ä¸åˆ†å¸ƒå¼ç³»ç»Ÿå…¸å‹çš„æ—¥å¿—è½®æ¢ç­–ç•¥å…¼å®¹ã€‚
å¯è§‚æµ‹æ€§ï¼šæ—¥å¿—æ˜“äºè¢«è§£æï¼ˆmachine-readableï¼‰ã€äººç±»å¯è¯»ï¼ˆhuman-readableï¼‰ã€‚å…¼å®¹ä¸»æµæ—¥å¿—å¤„ç†ç¨‹åºçš„æ ¼å¼ï¼Œç»´åº¦è®¾è®¡ä¾¿äºæ—¥ååšè¿‡æ»¤ç­›é€‰ã€‚

æ¶‰åŠçš„è¡Œä¸šæ ‡å‡†
ä¸å®¡è®¡ç›¸å…³çš„ï¼Œå¸¸è§çš„å·¥ä¸šæ ‡å‡†æœ‰ IEC62443ã€NIST SP 800-92ã€‚ä¸‹é¢æ˜¯ IEC ä¸­æ¶‰åŠåˆ°å®¡è®¡ç›¸å…³çš„ç« èŠ‚ã€‚

  
      
          å·¥ä¸šæ ‡å‡†
          ç« èŠ‚
          å®‰å…¨çº§åˆ«
      
  
  
      
          IEC 62443-4-2:2019
          CR2.8
          SL-C 1
      
      
          IEC 62443-4-2:2019
          CR6.1
          SL-C 1
      
      
          IEC 62443-4-2:2019
          CR6.2
          SL_C 2
      
      
          IEC 62443-4-2:2019
          CR1.13
          SL_C 1
      
      
          IEC 62443-4-2:2019
          CR2.9
          SL_C 1
      
      
          IEC 62443-4-2:2019
          CR2.10
          SL_C 1
      
      
          IEC 62443-4-2:2019
          CR3.7
          SL_C 1
      
      
          IEC 62443-4-2:2019
          CR3.9
          SL_C 2
      
  

å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†ï¼Ÿ
å¯¹äºæœ¬åœ°è¿è¡Œçš„è½¯ä»¶ï¼Œé€šå¸¸ Syslog å…·æœ‰æ›´å¥½çš„ç³»ç»Ÿå…¼å®¹æ€§ã€‚å¯¹äºä½¿ç”¨ ELK é‡‡é›†æ—¥å¿—çš„é¡¹ç›®æ›´é€‚åˆç”¨ CEFï¼Œå…¶ä»–æƒ…å†µå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰çš„ JSONã€‚"><meta name=keywords content="audit,"><link rel=canonical href=https://sund.site/posts/2024/audit-system-design/><meta property="og:url" content="https://sund.site/posts/2024/audit-system-design/"><meta property="og:site_name" content="Steve Sun"><meta property="og:title" content="å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¬¦åˆå·¥ä¸šæ ‡å‡†çš„å®¡è®¡ç³»ç»Ÿ"><meta property="og:description" content="å®¡è®¡è¿½è¸ªï¼ˆAudit Trailï¼‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿä¸­ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€æ§åˆ¶ç»„ä»¶çš„æ´»åŠ¨æ—¥å¿—ç­‰å…³é”®å®‰å…¨ä¿¡æ¯çš„æœåŠ¡ã€‚æ—¥å¿—é€šå¸¸ä»¥æ—¶é—´é¡ºåºæ’åˆ—ï¼Œè®°å½•äº†â€œè°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆâ€ã€‚
ä¸‹é¢æ˜¯ kubernetes å®˜æ–¹æ–‡æ¡£å¯¹å…¶å®¡è®¡æœåŠ¡çš„æè¿°ï¼š
Kubernetes å®¡è®¡ï¼ˆAuditingï¼‰ åŠŸèƒ½æä¾›äº†ä¸å®‰å…¨ç›¸å…³çš„ã€æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è®°å½•é›†ï¼Œè®°å½•æ¯ä¸ªç”¨æˆ·ã€ä½¿ç”¨ Kubernetes API çš„åº”ç”¨ä»¥åŠæ§åˆ¶é¢è‡ªèº«å¼•å‘çš„æ´»åŠ¨ã€‚
å®¡è®¡åŠŸèƒ½ä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š
å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ï¼Ÿ è°è§¦å‘çš„ï¼Ÿ æ´»åŠ¨å‘ç”Ÿåœ¨å“ªä¸ªï¼ˆäº›ï¼‰å¯¹è±¡ä¸Šï¼Ÿ åœ¨å“ªè§‚å¯Ÿåˆ°çš„ï¼Ÿ å®ƒä»å“ªè§¦å‘çš„ï¼Ÿ æ´»åŠ¨çš„åç»­å¤„ç†è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿ å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ æ—¥å¿—å†…å®¹ä¸å¯ç¯¡æ”¹ã€‚ æ—¥å¿—é“¾ç»“æ„å®Œæ•´ï¼šä¸å¯ä»»æ„æ·»åŠ æˆ–åˆ é™¤å•ç‹¬çš„æ—¥å¿—æ¡ç›®ã€‚ å…¼å®¹æ€§ï¼šå‘é€æ—¥å¿—çš„å®¢æˆ·ç«¯åº”è¯¥é¿å…ä¾µå…¥å¼è®¾è®¡ã€‚ ç³»ç»Ÿçš„åŠ å¯†æœåŠ¡åº”è¯¥å°½æ—©åˆå§‹åŒ–ï¼Œä»¥å‡å°‘æœªå—ä¿æŠ¤çš„æ—¥å¿—ã€‚ æœåŠ¡é‡å¯/å…³é—­ä¸åº”å¯¼è‡´å®¡æ ¸æ—¥å¿—ä¸ä¸€è‡´ã€‚å¦‚æœæœåŠ¡å› ç´§æ€¥æƒ…å†µè€Œå…³é—­ï¼Œå®¡è®¡æ—¥å¿—åº”è¯¥æ˜¯å¯éªŒè¯çš„ã€‚ å¯†é’¥å®‰å…¨æ€§ï¼šåŠ å¯†å¯†é’¥ï¼ˆç”¨äºè®¡ç®—å®Œæ•´æ€§æ£€æŸ¥ï¼‰åº”å­˜å‚¨åœ¨ä¸“ç”¨å¯†é’¥å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­é©»ç•™æœ€çŸ­çš„æ—¶é—´ã€‚ æ€§èƒ½ï¼šèƒ½å¤Ÿåœ¨å‡ ç§’é’Ÿå†…éªŒè¯å—ä¿æŠ¤æ—¥å¿—ã€‚ æ—¥å¿—è½®æ¢å‹å¥½æ€§ï¼šå®¡æ ¸æ—¥å¿—åº”ä¸åˆ†å¸ƒå¼ç³»ç»Ÿå…¸å‹çš„æ—¥å¿—è½®æ¢ç­–ç•¥å…¼å®¹ã€‚ å¯è§‚æµ‹æ€§ï¼šæ—¥å¿—æ˜“äºè¢«è§£æï¼ˆmachine-readableï¼‰ã€äººç±»å¯è¯»ï¼ˆhuman-readableï¼‰ã€‚å…¼å®¹ä¸»æµæ—¥å¿—å¤„ç†ç¨‹åºçš„æ ¼å¼ï¼Œç»´åº¦è®¾è®¡ä¾¿äºæ—¥ååšè¿‡æ»¤ç­›é€‰ã€‚ æ¶‰åŠçš„è¡Œä¸šæ ‡å‡† ä¸å®¡è®¡ç›¸å…³çš„ï¼Œå¸¸è§çš„å·¥ä¸šæ ‡å‡†æœ‰ IEC62443ã€NIST SP 800-92ã€‚ä¸‹é¢æ˜¯ IEC ä¸­æ¶‰åŠåˆ°å®¡è®¡ç›¸å…³çš„ç« èŠ‚ã€‚
å·¥ä¸šæ ‡å‡† ç« èŠ‚ å®‰å…¨çº§åˆ« IEC 62443-4-2:2019 CR2.8 SL-C 1 IEC 62443-4-2:2019 CR6.1 SL-C 1 IEC 62443-4-2:2019 CR6.2 SL_C 2 IEC 62443-4-2:2019 CR1.13 SL_C 1 IEC 62443-4-2:2019 CR2.9 SL_C 1 IEC 62443-4-2:2019 CR2.10 SL_C 1 IEC 62443-4-2:2019 CR3.7 SL_C 1 IEC 62443-4-2:2019 CR3.9 SL_C 2 å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†ï¼Ÿ å¯¹äºæœ¬åœ°è¿è¡Œçš„è½¯ä»¶ï¼Œé€šå¸¸ Syslog å…·æœ‰æ›´å¥½çš„ç³»ç»Ÿå…¼å®¹æ€§ã€‚å¯¹äºä½¿ç”¨ ELK é‡‡é›†æ—¥å¿—çš„é¡¹ç›®æ›´é€‚åˆç”¨ CEFï¼Œå…¶ä»–æƒ…å†µå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰çš„ JSONã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-15T16:44:40+08:00"><meta property="article:modified_time" content="2024-04-15T16:44:40+08:00"><meta property="article:tag" content="Audit"><meta property="og:image" content="https://sund.site/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sund.site/images/share.png"><meta name=twitter:title content="å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¬¦åˆå·¥ä¸šæ ‡å‡†çš„å®¡è®¡ç³»ç»Ÿ"><meta name=twitter:description content="å®¡è®¡è¿½è¸ªï¼ˆAudit Trailï¼‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿä¸­ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€æ§åˆ¶ç»„ä»¶çš„æ´»åŠ¨æ—¥å¿—ç­‰å…³é”®å®‰å…¨ä¿¡æ¯çš„æœåŠ¡ã€‚æ—¥å¿—é€šå¸¸ä»¥æ—¶é—´é¡ºåºæ’åˆ—ï¼Œè®°å½•äº†â€œè°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆâ€ã€‚
ä¸‹é¢æ˜¯ kubernetes å®˜æ–¹æ–‡æ¡£å¯¹å…¶å®¡è®¡æœåŠ¡çš„æè¿°ï¼š
Kubernetes å®¡è®¡ï¼ˆAuditingï¼‰ åŠŸèƒ½æä¾›äº†ä¸å®‰å…¨ç›¸å…³çš„ã€æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è®°å½•é›†ï¼Œè®°å½•æ¯ä¸ªç”¨æˆ·ã€ä½¿ç”¨ Kubernetes API çš„åº”ç”¨ä»¥åŠæ§åˆ¶é¢è‡ªèº«å¼•å‘çš„æ´»åŠ¨ã€‚
å®¡è®¡åŠŸèƒ½ä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š
å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ï¼Ÿ è°è§¦å‘çš„ï¼Ÿ æ´»åŠ¨å‘ç”Ÿåœ¨å“ªä¸ªï¼ˆäº›ï¼‰å¯¹è±¡ä¸Šï¼Ÿ åœ¨å“ªè§‚å¯Ÿåˆ°çš„ï¼Ÿ å®ƒä»å“ªè§¦å‘çš„ï¼Ÿ æ´»åŠ¨çš„åç»­å¤„ç†è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿ å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ æ—¥å¿—å†…å®¹ä¸å¯ç¯¡æ”¹ã€‚ æ—¥å¿—é“¾ç»“æ„å®Œæ•´ï¼šä¸å¯ä»»æ„æ·»åŠ æˆ–åˆ é™¤å•ç‹¬çš„æ—¥å¿—æ¡ç›®ã€‚ å…¼å®¹æ€§ï¼šå‘é€æ—¥å¿—çš„å®¢æˆ·ç«¯åº”è¯¥é¿å…ä¾µå…¥å¼è®¾è®¡ã€‚ ç³»ç»Ÿçš„åŠ å¯†æœåŠ¡åº”è¯¥å°½æ—©åˆå§‹åŒ–ï¼Œä»¥å‡å°‘æœªå—ä¿æŠ¤çš„æ—¥å¿—ã€‚ æœåŠ¡é‡å¯/å…³é—­ä¸åº”å¯¼è‡´å®¡æ ¸æ—¥å¿—ä¸ä¸€è‡´ã€‚å¦‚æœæœåŠ¡å› ç´§æ€¥æƒ…å†µè€Œå…³é—­ï¼Œå®¡è®¡æ—¥å¿—åº”è¯¥æ˜¯å¯éªŒè¯çš„ã€‚ å¯†é’¥å®‰å…¨æ€§ï¼šåŠ å¯†å¯†é’¥ï¼ˆç”¨äºè®¡ç®—å®Œæ•´æ€§æ£€æŸ¥ï¼‰åº”å­˜å‚¨åœ¨ä¸“ç”¨å¯†é’¥å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­é©»ç•™æœ€çŸ­çš„æ—¶é—´ã€‚ æ€§èƒ½ï¼šèƒ½å¤Ÿåœ¨å‡ ç§’é’Ÿå†…éªŒè¯å—ä¿æŠ¤æ—¥å¿—ã€‚ æ—¥å¿—è½®æ¢å‹å¥½æ€§ï¼šå®¡æ ¸æ—¥å¿—åº”ä¸åˆ†å¸ƒå¼ç³»ç»Ÿå…¸å‹çš„æ—¥å¿—è½®æ¢ç­–ç•¥å…¼å®¹ã€‚ å¯è§‚æµ‹æ€§ï¼šæ—¥å¿—æ˜“äºè¢«è§£æï¼ˆmachine-readableï¼‰ã€äººç±»å¯è¯»ï¼ˆhuman-readableï¼‰ã€‚å…¼å®¹ä¸»æµæ—¥å¿—å¤„ç†ç¨‹åºçš„æ ¼å¼ï¼Œç»´åº¦è®¾è®¡ä¾¿äºæ—¥ååšè¿‡æ»¤ç­›é€‰ã€‚ æ¶‰åŠçš„è¡Œä¸šæ ‡å‡† ä¸å®¡è®¡ç›¸å…³çš„ï¼Œå¸¸è§çš„å·¥ä¸šæ ‡å‡†æœ‰ IEC62443ã€NIST SP 800-92ã€‚ä¸‹é¢æ˜¯ IEC ä¸­æ¶‰åŠåˆ°å®¡è®¡ç›¸å…³çš„ç« èŠ‚ã€‚
å·¥ä¸šæ ‡å‡† ç« èŠ‚ å®‰å…¨çº§åˆ« IEC 62443-4-2:2019 CR2.8 SL-C 1 IEC 62443-4-2:2019 CR6.1 SL-C 1 IEC 62443-4-2:2019 CR6.2 SL_C 2 IEC 62443-4-2:2019 CR1.13 SL_C 1 IEC 62443-4-2:2019 CR2.9 SL_C 1 IEC 62443-4-2:2019 CR2.10 SL_C 1 IEC 62443-4-2:2019 CR3.7 SL_C 1 IEC 62443-4-2:2019 CR3.9 SL_C 2 å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†ï¼Ÿ å¯¹äºæœ¬åœ°è¿è¡Œçš„è½¯ä»¶ï¼Œé€šå¸¸ Syslog å…·æœ‰æ›´å¥½çš„ç³»ç»Ÿå…¼å®¹æ€§ã€‚å¯¹äºä½¿ç”¨ ELK é‡‡é›†æ—¥å¿—çš„é¡¹ç›®æ›´é€‚åˆç”¨ CEFï¼Œå…¶ä»–æƒ…å†µå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰çš„ JSONã€‚"><meta itemprop=name content="å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¬¦åˆå·¥ä¸šæ ‡å‡†çš„å®¡è®¡ç³»ç»Ÿ"><meta itemprop=description content="å®¡è®¡è¿½è¸ªï¼ˆAudit Trailï¼‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿä¸­ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€æ§åˆ¶ç»„ä»¶çš„æ´»åŠ¨æ—¥å¿—ç­‰å…³é”®å®‰å…¨ä¿¡æ¯çš„æœåŠ¡ã€‚æ—¥å¿—é€šå¸¸ä»¥æ—¶é—´é¡ºåºæ’åˆ—ï¼Œè®°å½•äº†â€œè°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆâ€ã€‚
ä¸‹é¢æ˜¯ kubernetes å®˜æ–¹æ–‡æ¡£å¯¹å…¶å®¡è®¡æœåŠ¡çš„æè¿°ï¼š
Kubernetes å®¡è®¡ï¼ˆAuditingï¼‰ åŠŸèƒ½æä¾›äº†ä¸å®‰å…¨ç›¸å…³çš„ã€æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è®°å½•é›†ï¼Œè®°å½•æ¯ä¸ªç”¨æˆ·ã€ä½¿ç”¨ Kubernetes API çš„åº”ç”¨ä»¥åŠæ§åˆ¶é¢è‡ªèº«å¼•å‘çš„æ´»åŠ¨ã€‚
å®¡è®¡åŠŸèƒ½ä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š
å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ï¼Ÿ è°è§¦å‘çš„ï¼Ÿ æ´»åŠ¨å‘ç”Ÿåœ¨å“ªä¸ªï¼ˆäº›ï¼‰å¯¹è±¡ä¸Šï¼Ÿ åœ¨å“ªè§‚å¯Ÿåˆ°çš„ï¼Ÿ å®ƒä»å“ªè§¦å‘çš„ï¼Ÿ æ´»åŠ¨çš„åç»­å¤„ç†è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿ å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ æ—¥å¿—å†…å®¹ä¸å¯ç¯¡æ”¹ã€‚ æ—¥å¿—é“¾ç»“æ„å®Œæ•´ï¼šä¸å¯ä»»æ„æ·»åŠ æˆ–åˆ é™¤å•ç‹¬çš„æ—¥å¿—æ¡ç›®ã€‚ å…¼å®¹æ€§ï¼šå‘é€æ—¥å¿—çš„å®¢æˆ·ç«¯åº”è¯¥é¿å…ä¾µå…¥å¼è®¾è®¡ã€‚ ç³»ç»Ÿçš„åŠ å¯†æœåŠ¡åº”è¯¥å°½æ—©åˆå§‹åŒ–ï¼Œä»¥å‡å°‘æœªå—ä¿æŠ¤çš„æ—¥å¿—ã€‚ æœåŠ¡é‡å¯/å…³é—­ä¸åº”å¯¼è‡´å®¡æ ¸æ—¥å¿—ä¸ä¸€è‡´ã€‚å¦‚æœæœåŠ¡å› ç´§æ€¥æƒ…å†µè€Œå…³é—­ï¼Œå®¡è®¡æ—¥å¿—åº”è¯¥æ˜¯å¯éªŒè¯çš„ã€‚ å¯†é’¥å®‰å…¨æ€§ï¼šåŠ å¯†å¯†é’¥ï¼ˆç”¨äºè®¡ç®—å®Œæ•´æ€§æ£€æŸ¥ï¼‰åº”å­˜å‚¨åœ¨ä¸“ç”¨å¯†é’¥å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­é©»ç•™æœ€çŸ­çš„æ—¶é—´ã€‚ æ€§èƒ½ï¼šèƒ½å¤Ÿåœ¨å‡ ç§’é’Ÿå†…éªŒè¯å—ä¿æŠ¤æ—¥å¿—ã€‚ æ—¥å¿—è½®æ¢å‹å¥½æ€§ï¼šå®¡æ ¸æ—¥å¿—åº”ä¸åˆ†å¸ƒå¼ç³»ç»Ÿå…¸å‹çš„æ—¥å¿—è½®æ¢ç­–ç•¥å…¼å®¹ã€‚ å¯è§‚æµ‹æ€§ï¼šæ—¥å¿—æ˜“äºè¢«è§£æï¼ˆmachine-readableï¼‰ã€äººç±»å¯è¯»ï¼ˆhuman-readableï¼‰ã€‚å…¼å®¹ä¸»æµæ—¥å¿—å¤„ç†ç¨‹åºçš„æ ¼å¼ï¼Œç»´åº¦è®¾è®¡ä¾¿äºæ—¥ååšè¿‡æ»¤ç­›é€‰ã€‚ æ¶‰åŠçš„è¡Œä¸šæ ‡å‡† ä¸å®¡è®¡ç›¸å…³çš„ï¼Œå¸¸è§çš„å·¥ä¸šæ ‡å‡†æœ‰ IEC62443ã€NIST SP 800-92ã€‚ä¸‹é¢æ˜¯ IEC ä¸­æ¶‰åŠåˆ°å®¡è®¡ç›¸å…³çš„ç« èŠ‚ã€‚
å·¥ä¸šæ ‡å‡† ç« èŠ‚ å®‰å…¨çº§åˆ« IEC 62443-4-2:2019 CR2.8 SL-C 1 IEC 62443-4-2:2019 CR6.1 SL-C 1 IEC 62443-4-2:2019 CR6.2 SL_C 2 IEC 62443-4-2:2019 CR1.13 SL_C 1 IEC 62443-4-2:2019 CR2.9 SL_C 1 IEC 62443-4-2:2019 CR2.10 SL_C 1 IEC 62443-4-2:2019 CR3.7 SL_C 1 IEC 62443-4-2:2019 CR3.9 SL_C 2 å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†ï¼Ÿ å¯¹äºæœ¬åœ°è¿è¡Œçš„è½¯ä»¶ï¼Œé€šå¸¸ Syslog å…·æœ‰æ›´å¥½çš„ç³»ç»Ÿå…¼å®¹æ€§ã€‚å¯¹äºä½¿ç”¨ ELK é‡‡é›†æ—¥å¿—çš„é¡¹ç›®æ›´é€‚åˆç”¨ CEFï¼Œå…¶ä»–æƒ…å†µå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰çš„ JSONã€‚"><meta itemprop=datePublished content="2024-04-15T16:44:40+08:00"><meta itemprop=dateModified content="2024-04-15T16:44:40+08:00"><meta itemprop=wordCount content="509"><meta itemprop=image content="https://sund.site/images/share.png"><meta itemprop=keywords content="Audit"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width-max:720px;--font-primary:Verdana, sans-serif;--font-secondary:monospace;--font-size-primary:1em;--font-size-secondary:0.8em;--body-bg-color:#fcfcfc;--bold-text-color:#222;--body-text-color:#444;--link-color:#3273dc;--link-visited-color:#8b6fcb;--table-border-color:#f2f2f2;--table-th-bg-color:#f2f2f2;--img-border-color:#f2f2f2;--code-bg-color:#f2f2f2;--code-text-color:#222;--blockquote-border-color:#666;--blockquote-text-color:#666;--upvoted-color:#FA8072}@media(prefers-color-scheme:dark){:root{--body-bg-color:#1c1c1c;--bold-text-color:#eee;--body-text-color:#ddd;--link-color:#8cc2dd;--link-visited-color:#c3b1ee;--table-border-color:#999;--table-th-bg-color:#999;--img-border-color:#999;--code-bg-color:#555;--code-text-color:#ddd;--blockquote-border-color:#ccc;--blockquote-text-color:#ccc}}body{font-family:var(--font-primary);font-size:var(--font-size-primary);margin:auto;padding:20px;max-width:var(--width-max);text-align:left;background-color:var(--body-bg-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--body-text-color)}h1,h2,h3,h4,h5,h6,strong,b{color:var(--bold-text-color)}h1,h2,h3,h4,h5,h6{margin:16px 0}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}.title{text-decoration:none;border:0}.title:hover{text-decoration:none}.title span{font-weight:400}nav a{margin-right:8px}textarea{width:100%;font-size:16px}input{font-size:14px}content{line-height:1.6}table{width:100%;border-collapse:collapse;border:1px solid var(--table-border-color);border-radius:4px}th,td{border:1px solid var(--table-border-color);padding:4px}th{background-color:var(--table-th-bg-color)}hr{border:0;border-top:1px dashed}img{max-width:100%;display:block;margin-left:auto;margin-right:auto;border:1px solid var(--img-border-color);border-radius:4px;content-visibility:auto;loading:lazy}img[src*="#minipic"]{max-width:50%;margin-left:0;margin-right:auto}i{font-style:normal}time{font-family:var(--font-secondary);font-size:15px}code{font-family:var(--font-secondary);background-color:var(--code-bg-color);color:var(--code-text-color);padding:2px;border-radius:4px}pre code{display:block;padding:16px;white-space:pre-wrap;overflow-x:auto}div.highlight pre{border-radius:4px}div.highlight code{background-color:var(--code-bg-color);color:var(--code-text-color)}blockquote{border-left:2px solid var(--blockquote-border-color);color:var(--blockquote-text-color);margin:0;padding-left:16px;font-style:normal}blockquote p{margin:0}footer{padding:25px 0;text-align:center;font-size:var(--font-size-secondary)}ul li:has(input){list-style-type:none;margin-left:-25.5px}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li span.grouped{flex:0 0 80px}ul.blog-posts li a:visited{color:var(--link-visited-color)}div.toc{position:fixed;top:50%;left:calc((100vw + var(--width-max))/2);transform:translateY(-50%);width:calc((90vw - var(--width-max))/2);max-height:80vh;overflow-y:auto;padding:20px 8px;z-index:99;&::-webkit-scrollbar { display:none; } -ms-overflow-style:none;scrollbar-width:none}div.toc ul{list-style-type:none;padding-left:0}div.toc ul li{margin:8px 0}div.toc ul li a{text-decoration:none;color:var(--blockquote-text-color)}div.toc ul li a:hover{color:var(--link-color)}button.upvote-btn{margin:0;padding:0;border:none;background:0 0;cursor:pointer;display:flex;flex-direction:column;align-items:center;color:var(--body-text-color)}button.upvoted{color:var(--upvoted-color)}span.upvote-count{margin-top:-4px;font-size:smaller}@media(max-width:500px){img[src*="#minipic"]{max-width:100%;margin-left:auto;margin-right:auto}div.toc{display:none}}</style><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/GuanKiapTsingKhai/dist/GuanKiapTsingKhai/result.css><style>body,div.post-body,h1,h2,h3,h4{font-family:microsoft yahei,pingfang sc,avenir,segoe ui,hiragino sans gb,STHeiti,microsoft sans serif,wenquanyi micro hei,sans-serif}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-XJJVVQ0LBH"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XJJVVQ0LBH")</script></head><body><header><a href=/ class=title><h1>Steve Sun</h1></a><nav><a href=/>Home</a>
<a href=/friends/>Friends</a>
<a href=/posts/>Posts</a></nav></header><main><h1>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¬¦åˆå·¥ä¸šæ ‡å‡†çš„å®¡è®¡ç³»ç»Ÿ</h1><p><i><time datetime=2024-04-15 pubdate>15 Apr, 2024</time></i></p><content><p>å®¡è®¡è¿½è¸ªï¼ˆAudit Trailï¼‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿä¸­ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€æ§åˆ¶ç»„ä»¶çš„æ´»åŠ¨æ—¥å¿—ç­‰å…³é”®å®‰å…¨ä¿¡æ¯çš„æœåŠ¡ã€‚æ—¥å¿—é€šå¸¸ä»¥æ—¶é—´é¡ºåºæ’åˆ—ï¼Œè®°å½•äº†â€œè°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆâ€ã€‚</p><p>ä¸‹é¢æ˜¯ kubernetes å®˜æ–¹æ–‡æ¡£å¯¹å…¶å®¡è®¡æœåŠ¡çš„æè¿°ï¼š</p><blockquote><p>Kubernetes å®¡è®¡ï¼ˆAuditingï¼‰ åŠŸèƒ½æä¾›äº†ä¸å®‰å…¨ç›¸å…³çš„ã€æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è®°å½•é›†ï¼Œè®°å½•æ¯ä¸ªç”¨æˆ·ã€ä½¿ç”¨ Kubernetes API çš„åº”ç”¨ä»¥åŠæ§åˆ¶é¢è‡ªèº«å¼•å‘çš„æ´»åŠ¨ã€‚</p><p>å®¡è®¡åŠŸèƒ½ä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ï¼Ÿ</li><li>è°è§¦å‘çš„ï¼Ÿ</li><li>æ´»åŠ¨å‘ç”Ÿåœ¨å“ªä¸ªï¼ˆäº›ï¼‰å¯¹è±¡ä¸Šï¼Ÿ</li><li>åœ¨å“ªè§‚å¯Ÿåˆ°çš„ï¼Ÿ</li><li>å®ƒä»å“ªè§¦å‘çš„ï¼Ÿ</li><li>æ´»åŠ¨çš„åç»­å¤„ç†è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿ</li></ul></blockquote><h2 id=å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›>å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ</h2><ol><li>æ—¥å¿—å†…å®¹ä¸å¯ç¯¡æ”¹ã€‚</li><li>æ—¥å¿—é“¾ç»“æ„å®Œæ•´ï¼šä¸å¯ä»»æ„æ·»åŠ æˆ–åˆ é™¤å•ç‹¬çš„æ—¥å¿—æ¡ç›®ã€‚</li><li>å…¼å®¹æ€§ï¼šå‘é€æ—¥å¿—çš„å®¢æˆ·ç«¯åº”è¯¥é¿å…ä¾µå…¥å¼è®¾è®¡ã€‚</li><li>ç³»ç»Ÿçš„åŠ å¯†æœåŠ¡åº”è¯¥å°½æ—©åˆå§‹åŒ–ï¼Œä»¥å‡å°‘æœªå—ä¿æŠ¤çš„æ—¥å¿—ã€‚</li><li>æœåŠ¡é‡å¯/å…³é—­ä¸åº”å¯¼è‡´å®¡æ ¸æ—¥å¿—ä¸ä¸€è‡´ã€‚å¦‚æœæœåŠ¡å› ç´§æ€¥æƒ…å†µè€Œå…³é—­ï¼Œå®¡è®¡æ—¥å¿—åº”è¯¥æ˜¯å¯éªŒè¯çš„ã€‚</li><li>å¯†é’¥å®‰å…¨æ€§ï¼šåŠ å¯†å¯†é’¥ï¼ˆç”¨äºè®¡ç®—å®Œæ•´æ€§æ£€æŸ¥ï¼‰åº”å­˜å‚¨åœ¨ä¸“ç”¨å¯†é’¥å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­é©»ç•™æœ€çŸ­çš„æ—¶é—´ã€‚</li><li>æ€§èƒ½ï¼šèƒ½å¤Ÿåœ¨å‡ ç§’é’Ÿå†…éªŒè¯å—ä¿æŠ¤æ—¥å¿—ã€‚</li><li>æ—¥å¿—è½®æ¢å‹å¥½æ€§ï¼šå®¡æ ¸æ—¥å¿—åº”ä¸åˆ†å¸ƒå¼ç³»ç»Ÿå…¸å‹çš„æ—¥å¿—è½®æ¢ç­–ç•¥å…¼å®¹ã€‚</li><li>å¯è§‚æµ‹æ€§ï¼šæ—¥å¿—æ˜“äºè¢«è§£æï¼ˆmachine-readableï¼‰ã€äººç±»å¯è¯»ï¼ˆhuman-readableï¼‰ã€‚å…¼å®¹ä¸»æµæ—¥å¿—å¤„ç†ç¨‹åºçš„æ ¼å¼ï¼Œç»´åº¦è®¾è®¡ä¾¿äºæ—¥ååšè¿‡æ»¤ç­›é€‰ã€‚</li></ol><h2 id=æ¶‰åŠçš„è¡Œä¸šæ ‡å‡†>æ¶‰åŠçš„è¡Œä¸šæ ‡å‡†</h2><p>ä¸å®¡è®¡ç›¸å…³çš„ï¼Œå¸¸è§çš„å·¥ä¸šæ ‡å‡†æœ‰ IEC62443ã€NIST SP 800-92ã€‚ä¸‹é¢æ˜¯ IEC ä¸­æ¶‰åŠåˆ°å®¡è®¡ç›¸å…³çš„ç« èŠ‚ã€‚</p><table><thead><tr><th>å·¥ä¸šæ ‡å‡†</th><th>ç« èŠ‚</th><th>å®‰å…¨çº§åˆ«</th></tr></thead><tbody><tr><td>IEC 62443-4-2:2019</td><td>CR2.8</td><td>SL-C 1</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR6.1</td><td>SL-C 1</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR6.2</td><td>SL_C 2</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR1.13</td><td>SL_C 1</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR2.9</td><td>SL_C 1</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR2.10</td><td>SL_C 1</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR3.7</td><td>SL_C 1</td></tr><tr><td>IEC 62443-4-2:2019</td><td>CR3.9</td><td>SL_C 2</td></tr></tbody></table><h2 id=å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†>å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†ï¼Ÿ</h2><p>å¯¹äºæœ¬åœ°è¿è¡Œçš„è½¯ä»¶ï¼Œé€šå¸¸ Syslog å…·æœ‰æ›´å¥½çš„ç³»ç»Ÿå…¼å®¹æ€§ã€‚å¯¹äºä½¿ç”¨ ELK é‡‡é›†æ—¥å¿—çš„é¡¹ç›®æ›´é€‚åˆç”¨ CEFï¼Œå…¶ä»–æƒ…å†µå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰çš„ JSONã€‚</p><p>ä¸‹é¢æ˜¯ä¸‰ç§æ ¼å¼ï¼ˆåè®®ï¼‰çš„å¯¹æ¯”ã€‚</p><h3 id=common-event-format-cefhttpsdocselasticcoenintegrationscef><a href=https://docs.elastic.co/en/integrations/cef>Common Event Format (CEF)</a></h3><p>Elastic-Search ä½¿ç”¨çš„ã€ä¸€ç§åŸºäº Event-souring æ€æƒ³è®¾è®¡çš„æ—¥å¿—æ ¼å¼ã€‚ä¼˜ç‚¹æ˜¯å†—ä½™ä¿¡æ¯å°‘ï¼Œé€‚åˆé…åˆ ELK ä½“ç³»æ„å»ºç›‘æ§ç³»ç»Ÿã€‚ å®ƒçš„ä¼ è¾“åŸºäº Syslog åè®®ï¼ŒåŒæ—¶æ‰©å±•äº†å¯è¯»æ€§çš„ key-valueï¼ŒåŸºäºæ–‡æœ¬çš„è®¾è®¡ä¹Ÿå¯ä»¥è®© CEF æ ¼å¼çš„æ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ã€‚æ€»ä½“æ¥è¯´ï¼Œå®ƒæ˜¯è¿™å‡ ç§æ ¼å¼ä¸­åœ¨å¯è¯»æ€§ã€æ•ˆç‡å’Œæ ‡å‡†ä¸‰æ–¹é¢æœ€å¹³è¡¡çš„ä¸€ä¸ªã€‚</p><h3 id=sysloghttpsdatatrackerietforgdochtmlrfc5424><a href=https://datatracker.ietf.org/doc/html/rfc5424>Syslog</a></h3><p>Syslog æ˜¯ Linux æ“ä½œç³»ç»Ÿé»˜è®¤çš„å®¡è®¡æ—¥å¿—æ ¼å¼ï¼Œé€šå¸¸é‡‡ç”¨å…¶ RFC5424 ç‰ˆæœ¬ã€‚å¤§éƒ¨åˆ† SIEM<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> ç³»ç»Ÿéƒ½æ”¯æŒè¿™ç§æ ¼å¼çš„å¯¼å…¥ã€‚
Syslog åè®®é€‚é…æ€§å¾ˆå¥½ï¼ŒåŸºäº mTLS çš„ Syslog ä¼ è¾“å¯ä»¥åœ¨å…¼å®¹ä¼ ç»Ÿè½¯ä»¶çš„åŒæ—¶ï¼Œæœ€å¤§ç¨‹åº¦ä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ä½†æ˜¯å¯¹äºå¾®æœåŠ¡æ¥è¯´ï¼Œå®ç°å’Œç»´æŠ¤æ ‡å‡†åè®®æˆæœ¬è¾ƒé«˜ã€‚æ‰€ä»¥å¦‚ AWS CloudTrail, OpenTelemetry ç­‰éƒ½é€‰æ‹©æ›´ç®€å•çš„ HTTPS + JSON æ ¼å¼ã€‚</p><h3 id=json-lineshttpsjsonlinesorg><a href=https://jsonlines.org/>JSON Lines</a></h3><p>å¤§éƒ¨åˆ† SaaS äº§å“éƒ½æ˜¯ç”¨ JSONï¼Œç®€å•é«˜æ•ˆã€‚JSON çš„ç‰¹ç‚¹æ˜¯å†—ä½™ä¿¡æ¯å¤šï¼Œç»“æ„å®¹æ˜“è§£æã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯<a href=https://opentelemetry.io/docs/specs/otel/logs/data-model/>OpenTelemetry å®˜æ–¹æ–‡æ¡£</a>æåˆ°çš„æ—¥å¿—æ¨¡å‹ä¸­çš„å­—æ®µï¼š</p><table><thead><tr><th>Field Name</th><th>Description</th></tr></thead><tbody><tr><td>Timestamp</td><td>Time when the event occurred.</td></tr><tr><td>ObservedTimestamp</td><td>Time when the event was observed.</td></tr><tr><td>TraceId</td><td>Request trace id.</td></tr><tr><td>SpanId</td><td>Request span id.</td></tr><tr><td>TraceFlags</td><td>W3C trace flag.</td></tr><tr><td>SeverityText</td><td>The severity text (also known as log level).</td></tr><tr><td>SeverityNumber</td><td>Numerical value of the severity.</td></tr><tr><td>Body</td><td>The body of the log record.</td></tr><tr><td>Resource</td><td>Describes the source of the log.</td></tr><tr><td>InstrumentationScope</td><td>Describes the scope that emitted the log.</td></tr><tr><td>Attributes</td><td>Additional information about the event.</td></tr></tbody></table><p>ä¸‹é¢æ˜¯ kubernetes apiserver å…³äº Audit æ¶ˆæ¯æ ¼å¼å®šä¹‰çš„ä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;audit.k8s.io/v1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;kind&#34;</span>: <span style=color:#e6db74>&#34;Event&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;level&#34;</span>: <span style=color:#e6db74>&#34;Metadata&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;auditID&#34;</span>: <span style=color:#e6db74>&#34;12345678-1234-1234-1234-1234567890ab&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;stage&#34;</span>: <span style=color:#e6db74>&#34;ResponseComplete&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;requestURI&#34;</span>: <span style=color:#e6db74>&#34;/api/v1/namespaces/default/pods&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;verb&#34;</span>: <span style=color:#e6db74>&#34;get&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;user&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;admin&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;uid&#34;</span>: <span style=color:#e6db74>&#34;1234&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;groups&#34;</span>: [<span style=color:#e6db74>&#34;system:masters&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;extra&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;someKey&#34;</span>: [<span style=color:#e6db74>&#34;someValue&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;sourceIPs&#34;</span>: [<span style=color:#e6db74>&#34;192.168.1.1&#34;</span>],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;userAgent&#34;</span>: <span style=color:#e6db74>&#34;kubectl/v1.20.0 (linux/amd64) kubernetes/abcdef&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;objectRef&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;resource&#34;</span>: <span style=color:#e6db74>&#34;pods&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;namespace&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;my-pod&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;uid&#34;</span>: <span style=color:#e6db74>&#34;abcdef12-3456-7890-abcd-ef1234567890&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;v1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;resourceVersion&#34;</span>: <span style=color:#e6db74>&#34;12345&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;subresource&#34;</span>: <span style=color:#e6db74>&#34;status&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;responseStatus&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;metadata&#34;</span>: {},
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#e6db74>&#34;Success&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;code&#34;</span>: <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;requestObject&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;my-pod&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;namespace&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;spec&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;containers&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;my-container&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;image&#34;</span>: <span style=color:#e6db74>&#34;my-image&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;responseObject&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;my-pod&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;namespace&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;resourceVersion&#34;</span>: <span style=color:#e6db74>&#34;12345&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;spec&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;containers&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;my-container&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;image&#34;</span>: <span style=color:#e6db74>&#34;my-image&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;status&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;phase&#34;</span>: <span style=color:#e6db74>&#34;Running&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;requestReceivedTimestamp&#34;</span>: <span style=color:#e6db74>&#34;2023-05-21T12:34:56Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;stageTimestamp&#34;</span>: <span style=color:#e6db74>&#34;2023-05-21T12:34:57Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;annotations&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;authorization.k8s.io/decision&#34;</span>: <span style=color:#e6db74>&#34;allow&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;authorization.k8s.io/reason&#34;</span>: <span style=color:#e6db74>&#34;RBAC: allowed by RoleBinding \&#34;admin-binding\&#34;&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=å¯¹äºå®‰å…¨æ€§æœ‰å“ªäº›è¦æ±‚>å¯¹äºå®‰å…¨æ€§æœ‰å“ªäº›è¦æ±‚ï¼Ÿ</h2><p>å¯¹äºå®¡è®¡æ—¥å¿—æ¥è¯´ï¼Œå®‰å…¨æ€§è¦æ±‚ä¼šè¢«ä¸€èˆ¬æ—¥å¿—ç³»ç»Ÿæ›´é«˜ã€‚</p><p>å®‰å…¨æ€§ï¼Œé€šå¸¸å¯ä»¥ä»æœºå¯†æ€§ï¼ˆConfidentialityï¼‰ï¼Œå®Œæ•´æ€§ï¼ˆIntegrityï¼‰ï¼Œå¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ä¸‰ä¸ªç»´åº¦æ¥è€ƒé‡ã€‚</p><h3 id=æœºå¯†æ€§>æœºå¯†æ€§</h3><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ç³»ç»Ÿçš„å®‰å…¨æ¼æ´ï¼Œè·å–ç‰¹æ®Šæƒé™ï¼Œè¿›è€ŒæŸ¥çœ‹æŸäº›å®¡è®¡æ—¥å¿—ã€‚</p><p>å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li>åŠ å¯†æ—¥å¿—ï¼šä½¿ç”¨åŠ å¯†æŠ€æœ¯å¯¹æ—¥å¿—è¿›è¡Œä¿æŠ¤ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·èƒ½å¤Ÿè®¿é—®å’Œä¿®æ”¹æ—¥å¿—ã€‚</li><li>è®¿é—®æ§åˆ¶ï¼šé™åˆ¶å¯¹å‘é€ã€æ¥æ”¶æ—¥å¿—æ¥å£çš„è®¿é—®æƒé™ã€‚</li><li>æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼šä¸åº”è¯¥åœ¨æ—¥å¿—ä¸­è®°å½•ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€è¯ä¹¦ç­‰ã€‚</li></ul><h3 id=å®Œæ•´æ€§>å®Œæ•´æ€§</h3><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ç³»ç»Ÿçš„å®‰å…¨æ¼æ´ï¼Œä¿®æ”¹ã€åˆ é™¤æŸäº›å®¡è®¡æ—¥å¿—ã€‚</p><p>é™¤äº†ä¸Šé¢æåˆ°çš„åŠ å¯†å’Œæƒé™æ§åˆ¶ï¼Œè¿˜å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li>å®Œæ•´æ€§æ£€æŸ¥<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>ï¼šåœ¨æ—¥å¿—æ¡ç›®ä¸­æ·»åŠ å“ˆå¸Œå€¼ï¼Œä»¥ä¾¿åœ¨éªŒè¯æ—¥å¿—æ—¶èƒ½å¤Ÿå¿«é€Ÿæ£€æµ‹åˆ°ä»»ä½•ç¯¡æ”¹æˆ–æˆªæ–­ã€‚</li><li>å®šæœŸå¤‡ä»½ï¼šå®šæœŸå¤‡ä»½æ—¥å¿—ï¼Œä»¥é˜²æ­¢æ”»å‡»è€…åˆ é™¤æˆ–ä¿®æ”¹æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®ã€‚</li></ul><p><strong>æ—¥å¿—æ–‡ä»¶çš„é™åˆ¶</strong>ï¼šé€šå¸¸è¦é™¤äº†é™åˆ¶æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œè¿˜è¦é™åˆ¶å¤‡ä»½æ•°é‡ã€æœ€é•¿å¤‡ä»½å¤©æ•°ç­‰ã€‚ä¸‹é¢æ˜¯ kubernetes ä¸­å…³äºæ—¥å¿—æ–‡ä»¶å­˜å‚¨çš„å‚æ•°ï¼š</p><ul><li>&ndash;audit-log-path æŒ‡å®šç”¨æ¥å†™å…¥å®¡è®¡äº‹ä»¶çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚ä¸æŒ‡å®šæ­¤æ ‡å¿—ä¼šç¦ç”¨æ—¥å¿—åç«¯ã€‚</li><li>&ndash;audit-log-maxage å®šä¹‰ä¿ç•™æ—§å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤©æ•°</li><li>&ndash;audit-log-maxbackup å®šä¹‰è¦ä¿ç•™çš„å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§æ•°é‡</li><li>&ndash;audit-log-maxsize å®šä¹‰å®¡è®¡æ—¥å¿—æ–‡ä»¶è½®è½¬ä¹‹å‰çš„æœ€å¤§å¤§å°ï¼ˆå…†å­—èŠ‚ï¼‰</li></ul><h3 id=å¯ç”¨æ€§>å¯ç”¨æ€§</h3><p>æ”»å‡»è€…å¯ä»¥æ”»å‡»å®¡è®¡è¿½è¸ªæœåŠ¡ï¼Œå¯¼è‡´å®¡è®¡è¿½è¸ªæœåŠ¡å†…å­˜ã€ç£ç›˜ç©ºé—´ä¸è¶³ç­‰ã€‚</p><ul><li>è®¾ç½®æœ€å¤§ç”¨é‡é™åˆ¶ï¼šå¯¹å†…å­˜ã€ç£ç›˜ç­‰æœåŠ¡å™¨èµ„æºåšå‡ºé™åˆ¶ã€‚</li><li>ç›‘æµ‹å’Œå“åº”ï¼šåŠæ—¶ç›‘æµ‹ç³»ç»Ÿèµ„æºæŒ‡æ ‡å’Œæ—¥å¿—çš„å˜åŒ–ï¼Œå¹¶å¯¹å¼‚å¸¸æ´»åŠ¨è¿›è¡Œå“åº”ã€‚</li></ul><p><strong>å®¡è®¡ä¸Šä¸‹æ–‡</strong>ï¼šè®°å½•å®¡è®¡æ—¥å¿—ä¼šæ˜¾è‘—å¢åŠ ç³»ç»Ÿå†…å­˜å’Œæµé‡çš„ä½¿ç”¨ã€‚æ‰€ä»¥å®¡è®¡æœåŠ¡åº”è¯¥ç¼“å­˜å®¡è®¡ç›¸å…³çš„ä¸Šä¸‹æ–‡ï¼Œå¦‚æœåŠ¡åç§°å’Œ ID çš„æ˜ å°„å…³ç³»ã€äº‹ä»¶ ID å’Œæè¿°ç­‰ã€‚ä¸åŒæœåŠ¡å‘å®¡è®¡æœåŠ¡å‘é€æ¶ˆæ¯æ—¶åº”ä»¥æœ€å°é•¿åº¦ä¸ºåŸåˆ™è®¾è®¡æ¶ˆæ¯ç»“æ„ã€‚å®¡è®¡æœåŠ¡çš„ç­–ç•¥ä¸­åº”è¯¥å…è®¸ç”¨æˆ·é…ç½®æ—¥å¿—çº§åˆ«ï¼Œè¿‡æ»¤è§„åˆ™ç­‰ä»¥å‡å°‘ç³»ç»Ÿè´Ÿæ‹…ã€‚</p><h2 id=æ—¥å¿—çš„å¯¼å‡º>æ—¥å¿—çš„å¯¼å‡º</h2><p>å®¡è®¡æœåŠ¡é™¤äº†å¯¼å‡ºæ–‡ä»¶æ ¼å¼çš„æ—¥å¿—ï¼Œé€šå¸¸ä¹Ÿè¦æ”¯æŒç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„å¯¼å‡ºã€‚æˆ‘ä»¬é€šå¸¸æŠŠåˆ†æã€å­˜å‚¨æ—¥å¿—çš„ç¬¬ä¸‰æ–¹æœåŠ¡ç§°ä¸º SIEM ï¼ˆSecurity information and event managementï¼‰ã€‚åœ¨ kubernetes ä¸­ï¼Œå¯¼å‡ºæ—¥å¿—åˆ°ç¬¬ä¸‰æ–¹ web æœåŠ¡çš„æ¨¡å—ç§°ä¸º webhookã€‚</p><p>å¯¼å‡ºåˆ°ç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šå¸¸å¯ä»¥é‡‡ç”¨æ ‡å‡†çš„ Syslog æ ¼å¼æˆ–æ˜¯ JSON Linesï¼Œæ”¯æŒèŒƒå›´æœ€å¹¿ã€‚æ­¤å¤–ï¼Œéœ€è¦è€ƒè™‘æ—¥å¿—æˆªæ–­ã€ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ‰¹å¤„ç†å’Œæµå¤„ç†çš„é…ç½®ç­‰ï¼Œå¯ä»¥å‚è€ƒ kubernetes çš„<a href=https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/audit/#webhook-backend>è¿™ç¯‡æ–‡æ¡£</a>ã€‚</p><h2 id=å¼€æºé¡¹ç›®çš„æ¶æ„è®¾è®¡>å¼€æºé¡¹ç›®çš„æ¶æ„è®¾è®¡</h2><p>ç”±äºè®¾è®¡ä¾§é‡ç‚¹ä¸åŒï¼Œä¸‹é¢æä¾›çš„æ¯ç§å¼€æºé¡¹ç›®éƒ½éœ€è¦æ…é‡è€ƒè™‘å…¶ä¼˜ç‚¹å’Œä¸è¶³ï¼Œå…¶ç‰¹æ€§æ˜¯å¦æ»¡è¶³è‡ªèº«éœ€è¦ã€ç³»ç»Ÿçš„ç¯å¢ƒæ˜¯åˆ†å¸ƒå¼è¿˜æ˜¯å•ä½“åº”ç”¨ã€‚</p><h3 id=auditd>Auditd</h3><p><img src=/images/audit-system-design/Linux-Auditd-Architecture.png alt=auditd-architecture></p><p>å¤§éƒ¨åˆ† Linux é»˜è®¤çš„å®¡è®¡æœåŠ¡ï¼Œé…åˆ rsyslog ç­‰å·¥å…·ï¼Œå¯ä»¥è§£å†³æœ¬åœ°è®¾å¤‡çš„æ—¥å¿—é‡‡é›†ã€æŸ¥çœ‹ã€è¿‡æ»¤ã€‚ rsyslog åŸºäºå­—ç¬¦ä¸² template çš„æ—¥å¿—æ ¼å¼é…ç½®å¯ä»¥æ»¡è¶³ä½¿ç”¨ä¸åŒ SIEM ç³»ç»Ÿçš„ç”¨æˆ·é›†æˆçš„éœ€è¦ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šåŸºäºè¿›ç¨‹é€šä¿¡ï¼Œæ ‡å‡†æ—¥å¿—æ ¼å¼ï¼Œæ˜“äºå¯¼å‡ºã€‚æ€§èƒ½ä¼˜å¼‚ã€‚</li><li>ä¸è¶³ï¼šè¿›ç¨‹æ¨¡å‹ä¸é€‚ç”¨äºç½‘ç»œæœåŠ¡ã€‚</li></ul><h3 id=aws-cloud-trail-å’Œ-kubernetes>AWS Cloud Trail å’Œ kubernetes</h3><p><img src=/images/audit-system-design/aws-audit.png alt="aws log"></p><p>AWS çš„ Cloud Trail é‡‡ç”¨åº”ç”¨æœåŠ¡ä¸»åŠ¨æ¨é€å®¡è®¡äº‹ä»¶çš„æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥ä¸ºè®¾è®¡è¿½è¸ªæœåŠ¡è®¾ç½®ç­–ç•¥ï¼Œæ”¶é›†åˆ°çš„æ—¥å¿—ä¼šåˆ†åˆ«æŒ‰éœ€æµå…¥åç»­çš„æ‰¹å¤„ç†å’Œæµå¤„ç†å·¥å…·é“¾ä¸­ã€‚</p><p>kubernetes çš„æ—¥å¿—æ”¶é›†ä¸ AWS å®ç°ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºä¸­å¿ƒåŒ–çš„æœåŠ¡ï¼Œä½†æ˜¯è¿™å¥—æ¶æ„è®¾è®¡å¹¶éåªä¸ºå®¡è®¡æ—¥å¿—ä¸€ç§æƒ…å†µè®¾è®¡ã€‚å®ƒéµå¾ªäº†å¾ˆå¤š kubernetes å£°æ˜å¼è®¾è®¡çš„ç†å¿µï¼Œéå¸¸å€¼å¾—å­¦ä¹ ã€‚</p><p><img src=/images/audit-system-design/k8s-audit.png alt="kubernetes log"></p><p>ä¾‹å¦‚ kubernetes ä¸“é—¨ä¸ºå®¡è®¡è®¾è®¡çš„ stageï¼š</p><blockquote><p>æ¯ä¸ªè¯·æ±‚éƒ½å¯è¢«è®°å½•å…¶ç›¸å…³çš„é˜¶æ®µï¼ˆstageï¼‰ã€‚å·²å®šä¹‰çš„é˜¶æ®µæœ‰ï¼š</p><ul><li>RequestReceived - æ­¤é˜¶æ®µå¯¹åº”å®¡è®¡å¤„ç†å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œ å¹¶ä¸”åœ¨å§”æ‰˜ç»™å…¶ä½™å¤„ç†å™¨ä¹‹å‰ç”Ÿæˆçš„äº‹ä»¶ã€‚</li><li>ResponseStarted - åœ¨å“åº”æ¶ˆæ¯çš„å¤´éƒ¨å‘é€åï¼Œå“åº”æ¶ˆæ¯ä½“å‘é€å‰ç”Ÿæˆçš„äº‹ä»¶ã€‚ åªæœ‰é•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚ï¼ˆä¾‹å¦‚ watchï¼‰æ‰ä¼šç”Ÿæˆè¿™ä¸ªé˜¶æ®µã€‚</li><li>ResponseComplete - å½“å“åº”æ¶ˆæ¯ä½“å®Œæˆå¹¶ä¸”æ²¡æœ‰æ›´å¤šæ•°æ®éœ€è¦ä¼ è¾“çš„æ—¶å€™ã€‚</li><li>Panic - å½“ panic å‘ç”Ÿæ—¶ç”Ÿæˆã€‚</li></ul></blockquote><p><a href=https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/audit/>kubernetes å®¡è®¡äº‹ä»¶</a> ä½¿ç”¨å’Œ Event API ä¸åŒçš„æ¶ˆæ¯ç»“æ„<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>ã€‚</p><p>ç»¼ä¸Šï¼Œäº‘å¹³å°çš„å®¡è®¡æœåŠ¡è®¾è®¡å¯ä»¥æ€»ç»“ä¸ºï¼š</p><ul><li>ä¼˜ç‚¹ï¼šå¾®æœåŠ¡è®¾è®¡ï¼ŒJSON æ ¼å¼æ—¥å¿—æ›´çµæ´»ï¼Œä¸­å¿ƒåŒ–çš„æ—¥å¿—æ”¶é›†æœåŠ¡æ˜“äºé›†æˆæ›´å¤šåº”ç”¨æœåŠ¡å’Œå¯¼å‡ºåˆ°å¼€æºæ•°æ®å¤„ç†å·¥å…·ã€‚</li><li>ä¸è¶³ï¼šåˆ†å¸ƒå¼æ¶æ„å¯¹å­˜å‚¨ã€æœåŠ¡ç«¯åŠ å¯†ã€é€šä¿¡å®‰å…¨æ€§å’Œå®Œæ•´æ€§è¦æ±‚æ›´é«˜ã€‚</li></ul><h3 id=opentelemetry>OpenTelemetry</h3><p><img src=/images/audit-system-design/opentel.png alt=OpenTel></p><p>OpenTelemetry æ˜¯ç°åœ¨äº‘åŸç”Ÿæœ€ä¸»æµçš„æ—¥å¿—æ¡†æ¶ã€‚å¯ä»¥æ”¯æŒä¾µå…¥å¼ï¼ˆSDKï¼‰ã€éä¾µå…¥å¼ï¼ˆAgentï¼‰ä¸¤ç§æ—¥å¿—é‡‡é›†æ¨¡å¼ã€‚Collector çš„è®¾è®¡å¯ä»¥è®©ä¸€éƒ¨åˆ†æ—¥å¿—å¤„ç†çš„å·¥ä½œæ”¾åœ¨æ—¥å¿—å‘é€ç«¯å®Œæˆã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå¾®æœåŠ¡è®¾è®¡ï¼Œæ”¯æŒ kubernetes ç­‰åŸºç¡€è®¾æ–½ï¼Œå¤šè¯­è¨€å¤šå¹³å°æä¾›äº† SDK å’Œæ‰©å±•èƒ½åŠ›ã€‚æœ‰å®Œå–„çš„å®‰å…¨ã€å®Œæ•´æ€§è€ƒè™‘ã€‚é€‚åˆä¸­å°ä¼ä¸šã€‚</li><li>ä¸è¶³ï¼šå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ—¥å¿—é‡‡é›†ä¾ç„¶éœ€è¦ä¾µå…¥åˆ° App å†…éƒ¨ä¿®æ”¹ä»£ç ã€‚æ—¥å¿—æ”¶é›†å·¥å…·å¯¹ Go ç­‰è¯­è¨€æ”¯æŒä¸å¤Ÿå¥½ï¼ˆæˆªè‡³æœ¬æ–‡ç¼–è¾‘æ—¶ï¼‰ã€‚</li></ul><h2 id=å°ç»“>å°ç»“</h2><p>å®¡è®¡è¿½è¸ªï¼ˆAudit Trailï¼‰æ˜¯æŒ‡ç³»ç»Ÿè®°å½•ä¸‹æ‰€æœ‰å½±å“æ“ä½œæˆ–äº‹ä»¶çš„æ—¶é—´é¡ºåºè®°å½•,ç”¨äºè¿½è¸ªç³»ç»Ÿæ´»åŠ¨ï¼Œæ ¸æŸ¥æ˜¯å¦å­˜åœ¨è¿è§„è¡Œä¸ºã€‚</p><p>å®¡è®¡æ—¥å¿—åº”å…·å¤‡ä»¥ä¸‹ç‰¹æ€§:</p><ul><li>ä¸å¯ç¯¡æ”¹(åŠ å¯†å­˜å‚¨ã€å®Œæ•´æ€§æ ¡éªŒ)</li><li>é«˜æ€§èƒ½(å¿«é€ŸéªŒè¯)</li><li>å¯è§‚æµ‹æ€§(æœºå™¨/äººç±»å¯è¯»)</li><li>å®‰å…¨æ€§(ä¿å¯†æ€§ã€å¯ç”¨æ€§ã€å®Œæ•´æ€§)</li></ul><p>å¸¸è§çš„å®¡è®¡æ—¥å¿—æ ¼å¼æœ‰ Syslogã€CEFã€JSON ç­‰,ä¸»è¦åŒºåˆ«åœ¨äºå†—ä½™ä¿¡æ¯ã€å¯è¯»æ€§å’Œä¸æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„å…¼å®¹æ€§ã€‚</p><p>å®¡è®¡æ—¥å¿—å…·æœ‰è¾ƒé«˜çš„å®‰å…¨æ€§è¦æ±‚ï¼š</p><ul><li>æœºå¯†æ€§ï¼šåªæœ‰æˆæƒç”¨æˆ·å¯è®¿é—®,é€šè¿‡è®¿é—®æ§åˆ¶å®ç°</li><li>å¯ç”¨æ€§ï¼šé˜²æ­¢è¢«æ”»å‡»è€…åˆ é™¤æˆ–ç ´å,é€šè¿‡é™åˆ¶èµ„æºä½¿ç”¨ã€å¤šå‰¯æœ¬å­˜å‚¨ç­‰å®ç°</li><li>å®Œæ•´æ€§ï¼šé˜²æ­¢è¢«ç¯¡æ”¹æˆ–æˆªæ–­,é€šè¿‡åŠ å¯†ã€å®Œæ•´æ€§æ ¡éªŒç­‰å®ç°</li></ul><p>ä¸€äº›å…¸å‹çš„å®¡è®¡æ—¥å¿—ç³»ç»Ÿæ¶æ„ï¼š</p><ul><li>Auditdã€rsyslog ç­‰ Linux åŸç”Ÿæ—¥å¿—ç¨‹åº</li><li>AWS ç­‰äº‘äº§å“</li><li>OpenTelemetry</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>SIEM æ˜¯å®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†(Security Information and Event Management)çš„ç¼©å†™ã€‚<a href=https://www.microsoft.com/en-us/security/business/security-101/what-is-siem>https://www.microsoft.com/en-us/security/business/security-101/what-is-siem</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>å¯¹äºæ—¥å¿—çš„åŠ å¯†ï¼Œä¸€èˆ¬åœ¨æœåŠ¡ç«¯ä¼šå¯¹æ—¥å¿—é¢å¤–æ·»åŠ  checksum é“¾æ¥æ ¡éªŒã€‚å¯ä»¥å‚è€ƒäºšé©¬é€Šçš„å®ç° <a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingServerSideEncryption.html>server-side encryption (SSE-S3)</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://kubernetes.io/zh-cn/docs/reference/config-api/apiserver-audit.v1/#audit-k8s-io-v1-Event>kubernetes å®¡è®¡äº‹ä»¶ç»“æ„å®šä¹‰</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><p><a href=https://sund.site/tags/audit/>#Audit</a></p><div class=toc><nav id=TableOfContents><ul><li><a href=#å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›>å®¡è®¡ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ</a></li><li><a href=#æ¶‰åŠçš„è¡Œä¸šæ ‡å‡†>æ¶‰åŠçš„è¡Œä¸šæ ‡å‡†</a></li><li><a href=#å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†>å®¡è®¡æ—¥å¿—çš„æ ¼å¼åº”éµå¾ªå“ªäº›åè®®æˆ–æ ‡å‡†ï¼Ÿ</a><ul><li><a href=#common-event-format-cefhttpsdocselasticcoenintegrationscef><a href=https://docs.elastic.co/en/integrations/cef>Common Event Format (CEF)</a></a></li><li><a href=#sysloghttpsdatatrackerietforgdochtmlrfc5424><a href=https://datatracker.ietf.org/doc/html/rfc5424>Syslog</a></a></li><li><a href=#json-lineshttpsjsonlinesorg><a href=https://jsonlines.org/>JSON Lines</a></a></li></ul></li><li><a href=#å¯¹äºå®‰å…¨æ€§æœ‰å“ªäº›è¦æ±‚>å¯¹äºå®‰å…¨æ€§æœ‰å“ªäº›è¦æ±‚ï¼Ÿ</a><ul><li><a href=#æœºå¯†æ€§>æœºå¯†æ€§</a></li><li><a href=#å®Œæ•´æ€§>å®Œæ•´æ€§</a></li><li><a href=#å¯ç”¨æ€§>å¯ç”¨æ€§</a></li></ul></li><li><a href=#æ—¥å¿—çš„å¯¼å‡º>æ—¥å¿—çš„å¯¼å‡º</a></li><li><a href=#å¼€æºé¡¹ç›®çš„æ¶æ„è®¾è®¡>å¼€æºé¡¹ç›®çš„æ¶æ„è®¾è®¡</a><ul><li><a href=#auditd>Auditd</a></li><li><a href=#aws-cloud-trail-å’Œ-kubernetes>AWS Cloud Trail å’Œ kubernetes</a></li><li><a href=#opentelemetry>OpenTelemetry</a></li></ul></li><li><a href=#å°ç»“>å°ç»“</a></li></ul></nav></div></main><footer>Subscribe via <a href=/index.xml>RSS</a>.<br>Made with
<a href=https://github.com/rokcso/hugo-bearblog-neo/>Hugo Bear Neo</a>.<br>Copyright Â© 2013-2025, Steve Sun.
ğŸ—ºï¸ <a href=/sitemap.xml>Sitemap</a>.</footer></body></html>