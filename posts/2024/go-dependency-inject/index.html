<!doctype html><html lang=zh-CN><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://sund.site/favicon.ico><title>Go è¯­è¨€çš„ä¾èµ–å€’ç½® | Steve Sun</title>
<meta name=title content="Go è¯­è¨€çš„ä¾èµ–å€’ç½®"><meta name=description content="
è¿™ç¯‡æ–‡ç« æ¯”è¾ƒåŸºç¡€ï¼Œæ˜¯æˆ‘åœ¨ç»™ Java ç¨‹åºå‘˜åš go è¯­è¨€åŸ¹è®­æ—¶ç”¨åˆ°çš„ã€‚

ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ï¼Ÿ
ä¾èµ–å€’ç½®ï¼Œæˆ–å«ä¾èµ–åè½¬ã€DIPï¼Œæ˜¯è½¯ä»¶å¼€å‘éå¸¸é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚å¾ˆå¤šç¨‹åºå‘˜æ²¡æœ‰äº†è§£è¿‡ç›¸å…³çŸ¥è¯†ï¼Œæˆ–è€…åªä» Java Spring çŸ¥é“å¤§è‡´æ€æƒ³ã€‚æˆ‘ä»Šå¤©æƒ³ç”¨ä¸€ç¯‡ç®€çŸ­çš„æ–‡ç« ï¼Œç”¨ Go è¯­è¨€åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè®²è§£ä¸€ä¸‹æ€ä¹ˆæœ€ç®€å•åœ°å®ç°ä¾èµ–å€’ç½®ã€‚
å¦‚æœä½ è¿˜ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒ wiki ä¸­çš„æè¿°ï¼Œæˆ–è€…é˜…è¯»é©¬ä¸ç¦å‹’å…³äº DIP çš„æ–‡ç« ã€‚
ä¾èµ–å€’ç½®åŸåˆ™è¦è§£å†³ä¸€ä¸ªè½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„é£é™©ï¼šä¾èµ–ã€‚
å°è¯•å›å¿†ä¸€ä¸‹ï¼š

å½“ä½ å°è¯•é€šè¿‡ Mock æ–¹å¼å±è”½åº•å±‚ç»†èŠ‚åšæµ‹è¯•æ—¶ï¼Œä½ å‘ç°ä½ è¦æµ‹è¯•çš„ç±»å¼•ç”¨äº†å¤§é‡æ¡†æ¶æä¾›çš„æ¥å£ï¼Œå¯¼è‡´ä½ éœ€è¦ mock å¤§é‡åº•å±‚çš„å®ç°ã€‚
å½“ä½ å°è¯•ä¿®æ”¹ä¸€ä¸ªæ—§çš„åº•å±‚ç±»ï¼Œä½†æ˜¯ä¾èµ–è¯¥ç±»çš„ä¸Šå±‚æœåŠ¡ç±»å¤ªå¤šï¼Œä½ ä¸€è¾¹æ‹…å¿ƒé€ æˆå‰¯ä½œç”¨ï¼Œä¸€è¾¹åœ¨æ‰€æœ‰ä¾èµ–çš„ä½ç½®é‡æ„ä¸Šå±‚ä»£ç ã€‚

æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªåœºæ™¯ï¼š
åœºæ™¯ 1 é‡Œï¼Œåº”ç”¨ç±»ä¾èµ–äºæ¡†æ¶æä¾›çš„å®ç°ï¼Œå¯¼è‡´åº”ç”¨ç±»å¾ˆéš¾ä»æ¡†æ¶ä¸Šå‰¥ç¦»å‡ºæ¥ï¼Œä¸šå†…å¤„ç†è¿™ç§é—®é¢˜çš„æ–¹æ³•å«æ§åˆ¶åè½¬ï¼ˆIoC, Inversion of Controlï¼‰ã€‚å³åº”ç”¨ç±»ä¸åº”è¯¥ä¾èµ–æ¡†æ¶ï¼Œè€Œæ˜¯æ¡†æ¶æä¾›æ’æ§½ä¸€æ ·ï¼ŒæŠŠåº”ç”¨ç±»æ³¨å†Œç»™æ¡†æ¶ï¼Œç”±æ¡†æ¶ç»Ÿä¸€è°ƒåº¦åº”ç”¨ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ã€‚
åœºæ™¯ 2 é‡Œï¼ŒæœåŠ¡ç±»ä¾èµ–åº•å±‚ç±»ï¼Œå¯¼è‡´åº•å±‚ä¿®æ”¹éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚è§£å†³åŠæ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDI, Dependency Injectionï¼‰ã€‚å³ä¸Šå±‚ç±»ä¸ç›´æ¥å¼•ç”¨åº•å±‚ç±»ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„åœ°æ–¹æŠŠä¸Šå±‚ç±»ä¾èµ–çš„åº•å±‚ç±»æ³¨å…¥è¿›æ¥ã€‚
æŠŠè¿™ä¸¤ä¸ªåœºæ™¯ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯ä¾èµ–å€’ç½®åŸåˆ™çš„æ ¸å¿ƒï¼š

é«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚
æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ã€‚è€Œå…·ä½“å®ç°åˆ™åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚

è¿™ä¸¤ä¸ªåŸåˆ™ä¿è¯äº†ä»£ç ä¸­æ¨¡å—çš„é«˜å†…èšã€ä½è€¦åˆï¼ŒåŒæ—¶ç»™ Mockã€è¿­ä»£æ›´æ–°æ¨¡å—åˆ›é€ äº†æ¡ä»¶ã€‚
ç”¨ Go è¯­è¨€å®ç°å®ƒ
å‡è®¾ç°åœ¨è¦ä»ä¸€ä¸ªç”¨æˆ·çš„æœåŠ¡ä¸­æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªæ¥å£ï¼ŒUserRepository ä½œä¸ºæ•°æ®å±‚è´Ÿè´£æŸ¥è¯¢æ•°æ®åº“ï¼Œ UserService è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒä¾èµ– UserRepositoryã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜è¦å†™ä¸€ä¸ª Mock çš„æ•°æ®å±‚å®ç°ã€‚ æ•´ä¸ªç»“æ„å¦‚ä¸‹å›¾ã€‚

æ¥ä¸‹æ¥éå¸¸è½»æ¾åœ°ï¼Œæˆ‘ä»¬å®ç°ä¸¤ä¸ªæ¥å£ï¼Œå¹¶å†™äº†ä»–ä»¬çš„å®ç°ç±»ã€‚åŒæ—¶æˆ‘ä»¬è¿˜åœ¨ UserService çš„å®ç°ç±»é‡Œå†™äº†ä¸€ä¸ª NewUserServiceï¼Œæ¥æŠŠå®ƒä¾èµ–çš„ UserRepository å®ç°æ³¨å…¥è¿›æ¥ã€‚
// åœ¨ user_repository.go ä¸­å®ç°å…·ä½“çš„æ¥å£
type UserRepository interface {
    GetByID(id int) (*User, error)
    Save(user *User) error
}

// ... å…·ä½“å®ç° UserRepositoryï¼Œç•¥

// user_service.go ä¸­å®ç°
type UserService interface {
    GetUser(id int) (*User, error)
    CreateUser(name string, age int) error
}

// ... å…·ä½“å®ç° UserServiceï¼Œç•¥

func NewUserService(repo UserRepository) UserService {
    return &amp;UserServiceImpl{
        repo: repo,
    }
}
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯ä¸å¯ä»¥ç›´æ¥åœ¨ user_service.go ä¸­ç›´æ¥æŠŠ repository å¼•ç”¨è¿›æ¥å‘¢ï¼Ÿæ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºè¿™æ ·ï¼Œä¸¤ä¸ªæ¨¡å—å°±å½¢æˆäº†ä¾èµ–å…³ç³»ã€‚"><meta name=keywords content="go,"><link rel=canonical href=https://sund.site/posts/2024/go-dependency-inject/><meta property="og:url" content="https://sund.site/posts/2024/go-dependency-inject/"><meta property="og:site_name" content="Steve Sun"><meta property="og:title" content="Go è¯­è¨€çš„ä¾èµ–å€’ç½®"><meta property="og:description" content="è¿™ç¯‡æ–‡ç« æ¯”è¾ƒåŸºç¡€ï¼Œæ˜¯æˆ‘åœ¨ç»™ Java ç¨‹åºå‘˜åš go è¯­è¨€åŸ¹è®­æ—¶ç”¨åˆ°çš„ã€‚
ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ï¼Ÿ ä¾èµ–å€’ç½®ï¼Œæˆ–å«ä¾èµ–åè½¬ã€DIPï¼Œæ˜¯è½¯ä»¶å¼€å‘éå¸¸é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚å¾ˆå¤šç¨‹åºå‘˜æ²¡æœ‰äº†è§£è¿‡ç›¸å…³çŸ¥è¯†ï¼Œæˆ–è€…åªä» Java Spring çŸ¥é“å¤§è‡´æ€æƒ³ã€‚æˆ‘ä»Šå¤©æƒ³ç”¨ä¸€ç¯‡ç®€çŸ­çš„æ–‡ç« ï¼Œç”¨ Go è¯­è¨€åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè®²è§£ä¸€ä¸‹æ€ä¹ˆæœ€ç®€å•åœ°å®ç°ä¾èµ–å€’ç½®ã€‚
å¦‚æœä½ è¿˜ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒ wiki ä¸­çš„æè¿°ï¼Œæˆ–è€…é˜…è¯»é©¬ä¸ç¦å‹’å…³äº DIP çš„æ–‡ç« ã€‚
ä¾èµ–å€’ç½®åŸåˆ™è¦è§£å†³ä¸€ä¸ªè½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„é£é™©ï¼šä¾èµ–ã€‚
å°è¯•å›å¿†ä¸€ä¸‹ï¼š
å½“ä½ å°è¯•é€šè¿‡ Mock æ–¹å¼å±è”½åº•å±‚ç»†èŠ‚åšæµ‹è¯•æ—¶ï¼Œä½ å‘ç°ä½ è¦æµ‹è¯•çš„ç±»å¼•ç”¨äº†å¤§é‡æ¡†æ¶æä¾›çš„æ¥å£ï¼Œå¯¼è‡´ä½ éœ€è¦ mock å¤§é‡åº•å±‚çš„å®ç°ã€‚ å½“ä½ å°è¯•ä¿®æ”¹ä¸€ä¸ªæ—§çš„åº•å±‚ç±»ï¼Œä½†æ˜¯ä¾èµ–è¯¥ç±»çš„ä¸Šå±‚æœåŠ¡ç±»å¤ªå¤šï¼Œä½ ä¸€è¾¹æ‹…å¿ƒé€ æˆå‰¯ä½œç”¨ï¼Œä¸€è¾¹åœ¨æ‰€æœ‰ä¾èµ–çš„ä½ç½®é‡æ„ä¸Šå±‚ä»£ç ã€‚ æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªåœºæ™¯ï¼š
åœºæ™¯ 1 é‡Œï¼Œåº”ç”¨ç±»ä¾èµ–äºæ¡†æ¶æä¾›çš„å®ç°ï¼Œå¯¼è‡´åº”ç”¨ç±»å¾ˆéš¾ä»æ¡†æ¶ä¸Šå‰¥ç¦»å‡ºæ¥ï¼Œä¸šå†…å¤„ç†è¿™ç§é—®é¢˜çš„æ–¹æ³•å«æ§åˆ¶åè½¬ï¼ˆIoC, Inversion of Controlï¼‰ã€‚å³åº”ç”¨ç±»ä¸åº”è¯¥ä¾èµ–æ¡†æ¶ï¼Œè€Œæ˜¯æ¡†æ¶æä¾›æ’æ§½ä¸€æ ·ï¼ŒæŠŠåº”ç”¨ç±»æ³¨å†Œç»™æ¡†æ¶ï¼Œç”±æ¡†æ¶ç»Ÿä¸€è°ƒåº¦åº”ç”¨ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ã€‚
åœºæ™¯ 2 é‡Œï¼ŒæœåŠ¡ç±»ä¾èµ–åº•å±‚ç±»ï¼Œå¯¼è‡´åº•å±‚ä¿®æ”¹éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚è§£å†³åŠæ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDI, Dependency Injectionï¼‰ã€‚å³ä¸Šå±‚ç±»ä¸ç›´æ¥å¼•ç”¨åº•å±‚ç±»ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„åœ°æ–¹æŠŠä¸Šå±‚ç±»ä¾èµ–çš„åº•å±‚ç±»æ³¨å…¥è¿›æ¥ã€‚
æŠŠè¿™ä¸¤ä¸ªåœºæ™¯ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯ä¾èµ–å€’ç½®åŸåˆ™çš„æ ¸å¿ƒï¼š
é«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚ æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ã€‚è€Œå…·ä½“å®ç°åˆ™åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚ è¿™ä¸¤ä¸ªåŸåˆ™ä¿è¯äº†ä»£ç ä¸­æ¨¡å—çš„é«˜å†…èšã€ä½è€¦åˆï¼ŒåŒæ—¶ç»™ Mockã€è¿­ä»£æ›´æ–°æ¨¡å—åˆ›é€ äº†æ¡ä»¶ã€‚
ç”¨ Go è¯­è¨€å®ç°å®ƒ å‡è®¾ç°åœ¨è¦ä»ä¸€ä¸ªç”¨æˆ·çš„æœåŠ¡ä¸­æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªæ¥å£ï¼ŒUserRepository ä½œä¸ºæ•°æ®å±‚è´Ÿè´£æŸ¥è¯¢æ•°æ®åº“ï¼Œ UserService è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒä¾èµ– UserRepositoryã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜è¦å†™ä¸€ä¸ª Mock çš„æ•°æ®å±‚å®ç°ã€‚ æ•´ä¸ªç»“æ„å¦‚ä¸‹å›¾ã€‚
æ¥ä¸‹æ¥éå¸¸è½»æ¾åœ°ï¼Œæˆ‘ä»¬å®ç°ä¸¤ä¸ªæ¥å£ï¼Œå¹¶å†™äº†ä»–ä»¬çš„å®ç°ç±»ã€‚åŒæ—¶æˆ‘ä»¬è¿˜åœ¨ UserService çš„å®ç°ç±»é‡Œå†™äº†ä¸€ä¸ª NewUserServiceï¼Œæ¥æŠŠå®ƒä¾èµ–çš„ UserRepository å®ç°æ³¨å…¥è¿›æ¥ã€‚
// åœ¨ user_repository.go ä¸­å®ç°å…·ä½“çš„æ¥å£ type UserRepository interface { GetByID(id int) (*User, error) Save(user *User) error } // ... å…·ä½“å®ç° UserRepositoryï¼Œç•¥ // user_service.go ä¸­å®ç° type UserService interface { GetUser(id int) (*User, error) CreateUser(name string, age int) error } // ... å…·ä½“å®ç° UserServiceï¼Œç•¥ func NewUserService(repo UserRepository) UserService { return &amp;UserServiceImpl{ repo: repo, } } é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯ä¸å¯ä»¥ç›´æ¥åœ¨ user_service.go ä¸­ç›´æ¥æŠŠ repository å¼•ç”¨è¿›æ¥å‘¢ï¼Ÿæ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºè¿™æ ·ï¼Œä¸¤ä¸ªæ¨¡å—å°±å½¢æˆäº†ä¾èµ–å…³ç³»ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-21T11:26:22+08:00"><meta property="article:modified_time" content="2024-11-21T11:26:22+08:00"><meta property="article:tag" content="Go"><meta property="og:image" content="https://sund.site/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sund.site/images/share.png"><meta name=twitter:title content="Go è¯­è¨€çš„ä¾èµ–å€’ç½®"><meta name=twitter:description content="è¿™ç¯‡æ–‡ç« æ¯”è¾ƒåŸºç¡€ï¼Œæ˜¯æˆ‘åœ¨ç»™ Java ç¨‹åºå‘˜åš go è¯­è¨€åŸ¹è®­æ—¶ç”¨åˆ°çš„ã€‚
ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ï¼Ÿ ä¾èµ–å€’ç½®ï¼Œæˆ–å«ä¾èµ–åè½¬ã€DIPï¼Œæ˜¯è½¯ä»¶å¼€å‘éå¸¸é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚å¾ˆå¤šç¨‹åºå‘˜æ²¡æœ‰äº†è§£è¿‡ç›¸å…³çŸ¥è¯†ï¼Œæˆ–è€…åªä» Java Spring çŸ¥é“å¤§è‡´æ€æƒ³ã€‚æˆ‘ä»Šå¤©æƒ³ç”¨ä¸€ç¯‡ç®€çŸ­çš„æ–‡ç« ï¼Œç”¨ Go è¯­è¨€åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè®²è§£ä¸€ä¸‹æ€ä¹ˆæœ€ç®€å•åœ°å®ç°ä¾èµ–å€’ç½®ã€‚
å¦‚æœä½ è¿˜ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒ wiki ä¸­çš„æè¿°ï¼Œæˆ–è€…é˜…è¯»é©¬ä¸ç¦å‹’å…³äº DIP çš„æ–‡ç« ã€‚
ä¾èµ–å€’ç½®åŸåˆ™è¦è§£å†³ä¸€ä¸ªè½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„é£é™©ï¼šä¾èµ–ã€‚
å°è¯•å›å¿†ä¸€ä¸‹ï¼š
å½“ä½ å°è¯•é€šè¿‡ Mock æ–¹å¼å±è”½åº•å±‚ç»†èŠ‚åšæµ‹è¯•æ—¶ï¼Œä½ å‘ç°ä½ è¦æµ‹è¯•çš„ç±»å¼•ç”¨äº†å¤§é‡æ¡†æ¶æä¾›çš„æ¥å£ï¼Œå¯¼è‡´ä½ éœ€è¦ mock å¤§é‡åº•å±‚çš„å®ç°ã€‚ å½“ä½ å°è¯•ä¿®æ”¹ä¸€ä¸ªæ—§çš„åº•å±‚ç±»ï¼Œä½†æ˜¯ä¾èµ–è¯¥ç±»çš„ä¸Šå±‚æœåŠ¡ç±»å¤ªå¤šï¼Œä½ ä¸€è¾¹æ‹…å¿ƒé€ æˆå‰¯ä½œç”¨ï¼Œä¸€è¾¹åœ¨æ‰€æœ‰ä¾èµ–çš„ä½ç½®é‡æ„ä¸Šå±‚ä»£ç ã€‚ æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªåœºæ™¯ï¼š
åœºæ™¯ 1 é‡Œï¼Œåº”ç”¨ç±»ä¾èµ–äºæ¡†æ¶æä¾›çš„å®ç°ï¼Œå¯¼è‡´åº”ç”¨ç±»å¾ˆéš¾ä»æ¡†æ¶ä¸Šå‰¥ç¦»å‡ºæ¥ï¼Œä¸šå†…å¤„ç†è¿™ç§é—®é¢˜çš„æ–¹æ³•å«æ§åˆ¶åè½¬ï¼ˆIoC, Inversion of Controlï¼‰ã€‚å³åº”ç”¨ç±»ä¸åº”è¯¥ä¾èµ–æ¡†æ¶ï¼Œè€Œæ˜¯æ¡†æ¶æä¾›æ’æ§½ä¸€æ ·ï¼ŒæŠŠåº”ç”¨ç±»æ³¨å†Œç»™æ¡†æ¶ï¼Œç”±æ¡†æ¶ç»Ÿä¸€è°ƒåº¦åº”ç”¨ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ã€‚
åœºæ™¯ 2 é‡Œï¼ŒæœåŠ¡ç±»ä¾èµ–åº•å±‚ç±»ï¼Œå¯¼è‡´åº•å±‚ä¿®æ”¹éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚è§£å†³åŠæ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDI, Dependency Injectionï¼‰ã€‚å³ä¸Šå±‚ç±»ä¸ç›´æ¥å¼•ç”¨åº•å±‚ç±»ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„åœ°æ–¹æŠŠä¸Šå±‚ç±»ä¾èµ–çš„åº•å±‚ç±»æ³¨å…¥è¿›æ¥ã€‚
æŠŠè¿™ä¸¤ä¸ªåœºæ™¯ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯ä¾èµ–å€’ç½®åŸåˆ™çš„æ ¸å¿ƒï¼š
é«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚ æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ã€‚è€Œå…·ä½“å®ç°åˆ™åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚ è¿™ä¸¤ä¸ªåŸåˆ™ä¿è¯äº†ä»£ç ä¸­æ¨¡å—çš„é«˜å†…èšã€ä½è€¦åˆï¼ŒåŒæ—¶ç»™ Mockã€è¿­ä»£æ›´æ–°æ¨¡å—åˆ›é€ äº†æ¡ä»¶ã€‚
ç”¨ Go è¯­è¨€å®ç°å®ƒ å‡è®¾ç°åœ¨è¦ä»ä¸€ä¸ªç”¨æˆ·çš„æœåŠ¡ä¸­æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªæ¥å£ï¼ŒUserRepository ä½œä¸ºæ•°æ®å±‚è´Ÿè´£æŸ¥è¯¢æ•°æ®åº“ï¼Œ UserService è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒä¾èµ– UserRepositoryã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜è¦å†™ä¸€ä¸ª Mock çš„æ•°æ®å±‚å®ç°ã€‚ æ•´ä¸ªç»“æ„å¦‚ä¸‹å›¾ã€‚
æ¥ä¸‹æ¥éå¸¸è½»æ¾åœ°ï¼Œæˆ‘ä»¬å®ç°ä¸¤ä¸ªæ¥å£ï¼Œå¹¶å†™äº†ä»–ä»¬çš„å®ç°ç±»ã€‚åŒæ—¶æˆ‘ä»¬è¿˜åœ¨ UserService çš„å®ç°ç±»é‡Œå†™äº†ä¸€ä¸ª NewUserServiceï¼Œæ¥æŠŠå®ƒä¾èµ–çš„ UserRepository å®ç°æ³¨å…¥è¿›æ¥ã€‚
// åœ¨ user_repository.go ä¸­å®ç°å…·ä½“çš„æ¥å£ type UserRepository interface { GetByID(id int) (*User, error) Save(user *User) error } // ... å…·ä½“å®ç° UserRepositoryï¼Œç•¥ // user_service.go ä¸­å®ç° type UserService interface { GetUser(id int) (*User, error) CreateUser(name string, age int) error } // ... å…·ä½“å®ç° UserServiceï¼Œç•¥ func NewUserService(repo UserRepository) UserService { return &amp;UserServiceImpl{ repo: repo, } } é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯ä¸å¯ä»¥ç›´æ¥åœ¨ user_service.go ä¸­ç›´æ¥æŠŠ repository å¼•ç”¨è¿›æ¥å‘¢ï¼Ÿæ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºè¿™æ ·ï¼Œä¸¤ä¸ªæ¨¡å—å°±å½¢æˆäº†ä¾èµ–å…³ç³»ã€‚"><meta itemprop=name content="Go è¯­è¨€çš„ä¾èµ–å€’ç½®"><meta itemprop=description content="è¿™ç¯‡æ–‡ç« æ¯”è¾ƒåŸºç¡€ï¼Œæ˜¯æˆ‘åœ¨ç»™ Java ç¨‹åºå‘˜åš go è¯­è¨€åŸ¹è®­æ—¶ç”¨åˆ°çš„ã€‚
ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ï¼Ÿ ä¾èµ–å€’ç½®ï¼Œæˆ–å«ä¾èµ–åè½¬ã€DIPï¼Œæ˜¯è½¯ä»¶å¼€å‘éå¸¸é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚å¾ˆå¤šç¨‹åºå‘˜æ²¡æœ‰äº†è§£è¿‡ç›¸å…³çŸ¥è¯†ï¼Œæˆ–è€…åªä» Java Spring çŸ¥é“å¤§è‡´æ€æƒ³ã€‚æˆ‘ä»Šå¤©æƒ³ç”¨ä¸€ç¯‡ç®€çŸ­çš„æ–‡ç« ï¼Œç”¨ Go è¯­è¨€åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè®²è§£ä¸€ä¸‹æ€ä¹ˆæœ€ç®€å•åœ°å®ç°ä¾èµ–å€’ç½®ã€‚
å¦‚æœä½ è¿˜ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒ wiki ä¸­çš„æè¿°ï¼Œæˆ–è€…é˜…è¯»é©¬ä¸ç¦å‹’å…³äº DIP çš„æ–‡ç« ã€‚
ä¾èµ–å€’ç½®åŸåˆ™è¦è§£å†³ä¸€ä¸ªè½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„é£é™©ï¼šä¾èµ–ã€‚
å°è¯•å›å¿†ä¸€ä¸‹ï¼š
å½“ä½ å°è¯•é€šè¿‡ Mock æ–¹å¼å±è”½åº•å±‚ç»†èŠ‚åšæµ‹è¯•æ—¶ï¼Œä½ å‘ç°ä½ è¦æµ‹è¯•çš„ç±»å¼•ç”¨äº†å¤§é‡æ¡†æ¶æä¾›çš„æ¥å£ï¼Œå¯¼è‡´ä½ éœ€è¦ mock å¤§é‡åº•å±‚çš„å®ç°ã€‚ å½“ä½ å°è¯•ä¿®æ”¹ä¸€ä¸ªæ—§çš„åº•å±‚ç±»ï¼Œä½†æ˜¯ä¾èµ–è¯¥ç±»çš„ä¸Šå±‚æœåŠ¡ç±»å¤ªå¤šï¼Œä½ ä¸€è¾¹æ‹…å¿ƒé€ æˆå‰¯ä½œç”¨ï¼Œä¸€è¾¹åœ¨æ‰€æœ‰ä¾èµ–çš„ä½ç½®é‡æ„ä¸Šå±‚ä»£ç ã€‚ æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªåœºæ™¯ï¼š
åœºæ™¯ 1 é‡Œï¼Œåº”ç”¨ç±»ä¾èµ–äºæ¡†æ¶æä¾›çš„å®ç°ï¼Œå¯¼è‡´åº”ç”¨ç±»å¾ˆéš¾ä»æ¡†æ¶ä¸Šå‰¥ç¦»å‡ºæ¥ï¼Œä¸šå†…å¤„ç†è¿™ç§é—®é¢˜çš„æ–¹æ³•å«æ§åˆ¶åè½¬ï¼ˆIoC, Inversion of Controlï¼‰ã€‚å³åº”ç”¨ç±»ä¸åº”è¯¥ä¾èµ–æ¡†æ¶ï¼Œè€Œæ˜¯æ¡†æ¶æä¾›æ’æ§½ä¸€æ ·ï¼ŒæŠŠåº”ç”¨ç±»æ³¨å†Œç»™æ¡†æ¶ï¼Œç”±æ¡†æ¶ç»Ÿä¸€è°ƒåº¦åº”ç”¨ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ã€‚
åœºæ™¯ 2 é‡Œï¼ŒæœåŠ¡ç±»ä¾èµ–åº•å±‚ç±»ï¼Œå¯¼è‡´åº•å±‚ä¿®æ”¹éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚è§£å†³åŠæ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDI, Dependency Injectionï¼‰ã€‚å³ä¸Šå±‚ç±»ä¸ç›´æ¥å¼•ç”¨åº•å±‚ç±»ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„åœ°æ–¹æŠŠä¸Šå±‚ç±»ä¾èµ–çš„åº•å±‚ç±»æ³¨å…¥è¿›æ¥ã€‚
æŠŠè¿™ä¸¤ä¸ªåœºæ™¯ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯ä¾èµ–å€’ç½®åŸåˆ™çš„æ ¸å¿ƒï¼š
é«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚ æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ã€‚è€Œå…·ä½“å®ç°åˆ™åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚ è¿™ä¸¤ä¸ªåŸåˆ™ä¿è¯äº†ä»£ç ä¸­æ¨¡å—çš„é«˜å†…èšã€ä½è€¦åˆï¼ŒåŒæ—¶ç»™ Mockã€è¿­ä»£æ›´æ–°æ¨¡å—åˆ›é€ äº†æ¡ä»¶ã€‚
ç”¨ Go è¯­è¨€å®ç°å®ƒ å‡è®¾ç°åœ¨è¦ä»ä¸€ä¸ªç”¨æˆ·çš„æœåŠ¡ä¸­æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªæ¥å£ï¼ŒUserRepository ä½œä¸ºæ•°æ®å±‚è´Ÿè´£æŸ¥è¯¢æ•°æ®åº“ï¼Œ UserService è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒä¾èµ– UserRepositoryã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜è¦å†™ä¸€ä¸ª Mock çš„æ•°æ®å±‚å®ç°ã€‚ æ•´ä¸ªç»“æ„å¦‚ä¸‹å›¾ã€‚
æ¥ä¸‹æ¥éå¸¸è½»æ¾åœ°ï¼Œæˆ‘ä»¬å®ç°ä¸¤ä¸ªæ¥å£ï¼Œå¹¶å†™äº†ä»–ä»¬çš„å®ç°ç±»ã€‚åŒæ—¶æˆ‘ä»¬è¿˜åœ¨ UserService çš„å®ç°ç±»é‡Œå†™äº†ä¸€ä¸ª NewUserServiceï¼Œæ¥æŠŠå®ƒä¾èµ–çš„ UserRepository å®ç°æ³¨å…¥è¿›æ¥ã€‚
// åœ¨ user_repository.go ä¸­å®ç°å…·ä½“çš„æ¥å£ type UserRepository interface { GetByID(id int) (*User, error) Save(user *User) error } // ... å…·ä½“å®ç° UserRepositoryï¼Œç•¥ // user_service.go ä¸­å®ç° type UserService interface { GetUser(id int) (*User, error) CreateUser(name string, age int) error } // ... å…·ä½“å®ç° UserServiceï¼Œç•¥ func NewUserService(repo UserRepository) UserService { return &amp;UserServiceImpl{ repo: repo, } } é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯ä¸å¯ä»¥ç›´æ¥åœ¨ user_service.go ä¸­ç›´æ¥æŠŠ repository å¼•ç”¨è¿›æ¥å‘¢ï¼Ÿæ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºè¿™æ ·ï¼Œä¸¤ä¸ªæ¨¡å—å°±å½¢æˆäº†ä¾èµ–å…³ç³»ã€‚"><meta itemprop=datePublished content="2024-11-21T11:26:22+08:00"><meta itemprop=dateModified content="2024-11-21T11:26:22+08:00"><meta itemprop=wordCount content="162"><meta itemprop=image content="https://sund.site/images/share.png"><meta itemprop=keywords content="Go"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width-max:720px;--font-primary:Verdana, sans-serif;--font-secondary:monospace;--font-size-primary:1em;--font-size-secondary:0.8em;--body-bg-color:#fcfcfc;--bold-text-color:#222;--body-text-color:#444;--link-color:#3273dc;--link-visited-color:#8b6fcb;--table-border-color:#f2f2f2;--table-th-bg-color:#f2f2f2;--img-border-color:#f2f2f2;--code-bg-color:#f2f2f2;--code-text-color:#222;--blockquote-border-color:#666;--blockquote-text-color:#666;--upvoted-color:#FA8072}@media(prefers-color-scheme:dark){:root{--body-bg-color:#1c1c1c;--bold-text-color:#eee;--body-text-color:#ddd;--link-color:#8cc2dd;--link-visited-color:#c3b1ee;--table-border-color:#999;--table-th-bg-color:#999;--img-border-color:#999;--code-bg-color:#555;--code-text-color:#ddd;--blockquote-border-color:#ccc;--blockquote-text-color:#ccc}}body{font-family:var(--font-primary);font-size:var(--font-size-primary);margin:auto;padding:20px;max-width:var(--width-max);text-align:left;background-color:var(--body-bg-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--body-text-color)}h1,h2,h3,h4,h5,h6,strong,b{color:var(--bold-text-color)}h1,h2,h3,h4,h5,h6{margin:16px 0}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}.title{text-decoration:none;border:0}.title:hover{text-decoration:none}.title span{font-weight:400}nav a{margin-right:8px}textarea{width:100%;font-size:16px}input{font-size:14px}content{line-height:1.6}table{width:100%;border-collapse:collapse;border:1px solid var(--table-border-color);border-radius:4px}th,td{border:1px solid var(--table-border-color);padding:4px}th{background-color:var(--table-th-bg-color)}hr{border:0;border-top:1px dashed}img{max-width:100%;display:block;margin-left:auto;margin-right:auto;border:1px solid var(--img-border-color);border-radius:4px;content-visibility:auto;loading:lazy}img[src*="#minipic"]{max-width:50%;margin-left:0;margin-right:auto}i{font-style:normal}time{font-family:var(--font-secondary);font-size:15px}code{font-family:var(--font-secondary);background-color:var(--code-bg-color);color:var(--code-text-color);padding:2px;border-radius:4px}pre code{display:block;padding:16px;white-space:pre-wrap;overflow-x:auto}div.highlight pre{border-radius:4px}div.highlight code{background-color:var(--code-bg-color);color:var(--code-text-color)}blockquote{border-left:2px solid var(--blockquote-border-color);color:var(--blockquote-text-color);margin:0;padding-left:16px;font-style:normal}blockquote p{margin:0}footer{padding:25px 0;text-align:center;font-size:var(--font-size-secondary)}ul li:has(input){list-style-type:none;margin-left:-25.5px}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li span.grouped{flex:0 0 80px}ul.blog-posts li a:visited{color:var(--link-visited-color)}div.toc{position:fixed;top:50%;left:calc((100vw + var(--width-max))/2);transform:translateY(-50%);width:calc((90vw - var(--width-max))/2);max-height:80vh;overflow-y:auto;padding:20px 8px;z-index:99;&::-webkit-scrollbar { display:none; } -ms-overflow-style:none;scrollbar-width:none}div.toc ul{list-style-type:none;padding-left:0}div.toc ul li{margin:8px 0}div.toc ul li a{text-decoration:none;color:var(--blockquote-text-color)}div.toc ul li a:hover{color:var(--link-color)}button.upvote-btn{margin:0;padding:0;border:none;background:0 0;cursor:pointer;display:flex;flex-direction:column;align-items:center;color:var(--body-text-color)}button.upvoted{color:var(--upvoted-color)}span.upvote-count{margin-top:-4px;font-size:smaller}@media(max-width:500px){img[src*="#minipic"]{max-width:100%;margin-left:auto;margin-right:auto}div.toc{display:none}}</style><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/GuanKiapTsingKhai/dist/GuanKiapTsingKhai/result.css><style>body,div.post-body,h1,h2,h3,h4{font-family:microsoft yahei,pingfang sc,avenir,segoe ui,hiragino sans gb,STHeiti,microsoft sans serif,wenquanyi micro hei,sans-serif}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-XJJVVQ0LBH"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XJJVVQ0LBH")</script></head><body><header><a href=/ class=title><h1>Steve Sun</h1></a><nav><a href=/>Home</a>
<a href=/friends/>Friends</a>
<a href=/posts/>Posts</a></nav></header><main><h1>Go è¯­è¨€çš„ä¾èµ–å€’ç½®</h1><p><i><time datetime=2024-11-21 pubdate>21 Nov, 2024</time></i></p><content><blockquote><p>è¿™ç¯‡æ–‡ç« æ¯”è¾ƒåŸºç¡€ï¼Œæ˜¯æˆ‘åœ¨ç»™ Java ç¨‹åºå‘˜åš go è¯­è¨€åŸ¹è®­æ—¶ç”¨åˆ°çš„ã€‚</p></blockquote><h2 id=ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®dip>ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ï¼Ÿ</h2><p><a href=https://en.wikipedia.org/wiki/Dependency_inversion_principle>ä¾èµ–å€’ç½®</a>ï¼Œæˆ–å«ä¾èµ–åè½¬ã€DIPï¼Œæ˜¯è½¯ä»¶å¼€å‘éå¸¸é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚å¾ˆå¤šç¨‹åºå‘˜æ²¡æœ‰äº†è§£è¿‡ç›¸å…³çŸ¥è¯†ï¼Œæˆ–è€…åªä» Java Spring çŸ¥é“å¤§è‡´æ€æƒ³ã€‚æˆ‘ä»Šå¤©æƒ³ç”¨ä¸€ç¯‡ç®€çŸ­çš„æ–‡ç« ï¼Œç”¨ Go è¯­è¨€åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè®²è§£ä¸€ä¸‹æ€ä¹ˆæœ€ç®€å•åœ°å®ç°ä¾èµ–å€’ç½®ã€‚</p><p>å¦‚æœä½ è¿˜ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒ wiki ä¸­çš„æè¿°ï¼Œæˆ–è€…é˜…è¯»<a href=https://martinfowler.com/articles/dipInTheWild.html>é©¬ä¸ç¦å‹’å…³äº DIP çš„æ–‡ç« </a>ã€‚</p><p>ä¾èµ–å€’ç½®åŸåˆ™è¦è§£å†³ä¸€ä¸ªè½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„é£é™©ï¼šä¾èµ–ã€‚</p><p>å°è¯•å›å¿†ä¸€ä¸‹ï¼š</p><ol><li>å½“ä½ å°è¯•é€šè¿‡ Mock æ–¹å¼å±è”½åº•å±‚ç»†èŠ‚åšæµ‹è¯•æ—¶ï¼Œä½ å‘ç°ä½ è¦æµ‹è¯•çš„ç±»å¼•ç”¨äº†å¤§é‡æ¡†æ¶æä¾›çš„æ¥å£ï¼Œå¯¼è‡´ä½ éœ€è¦ mock å¤§é‡åº•å±‚çš„å®ç°ã€‚</li><li>å½“ä½ å°è¯•ä¿®æ”¹ä¸€ä¸ªæ—§çš„åº•å±‚ç±»ï¼Œä½†æ˜¯ä¾èµ–è¯¥ç±»çš„ä¸Šå±‚æœåŠ¡ç±»å¤ªå¤šï¼Œä½ ä¸€è¾¹æ‹…å¿ƒé€ æˆå‰¯ä½œç”¨ï¼Œä¸€è¾¹åœ¨æ‰€æœ‰ä¾èµ–çš„ä½ç½®é‡æ„ä¸Šå±‚ä»£ç ã€‚</li></ol><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªåœºæ™¯ï¼š</p><p>åœºæ™¯ 1 é‡Œï¼Œåº”ç”¨ç±»ä¾èµ–äºæ¡†æ¶æä¾›çš„å®ç°ï¼Œå¯¼è‡´åº”ç”¨ç±»å¾ˆéš¾ä»æ¡†æ¶ä¸Šå‰¥ç¦»å‡ºæ¥ï¼Œä¸šå†…å¤„ç†è¿™ç§é—®é¢˜çš„æ–¹æ³•å«<strong>æ§åˆ¶åè½¬</strong>ï¼ˆIoC, Inversion of Controlï¼‰ã€‚å³åº”ç”¨ç±»ä¸åº”è¯¥ä¾èµ–æ¡†æ¶ï¼Œè€Œæ˜¯æ¡†æ¶æä¾›æ’æ§½ä¸€æ ·ï¼ŒæŠŠåº”ç”¨ç±»æ³¨å†Œç»™æ¡†æ¶ï¼Œç”±æ¡†æ¶ç»Ÿä¸€è°ƒåº¦åº”ç”¨ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ã€‚</p><p>åœºæ™¯ 2 é‡Œï¼ŒæœåŠ¡ç±»ä¾èµ–åº•å±‚ç±»ï¼Œå¯¼è‡´åº•å±‚ä¿®æ”¹éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚è§£å†³åŠæ³•æ˜¯<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆDI, Dependency Injectionï¼‰ã€‚å³ä¸Šå±‚ç±»ä¸ç›´æ¥å¼•ç”¨åº•å±‚ç±»ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„åœ°æ–¹æŠŠä¸Šå±‚ç±»ä¾èµ–çš„åº•å±‚ç±»æ³¨å…¥è¿›æ¥ã€‚</p><p>æŠŠè¿™ä¸¤ä¸ªåœºæ™¯ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯ä¾èµ–å€’ç½®åŸåˆ™çš„æ ¸å¿ƒï¼š</p><ul><li>é«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚</li><li>æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ã€‚è€Œå…·ä½“å®ç°åˆ™åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚</li></ul><p>è¿™ä¸¤ä¸ªåŸåˆ™ä¿è¯äº†ä»£ç ä¸­æ¨¡å—çš„é«˜å†…èšã€ä½è€¦åˆï¼ŒåŒæ—¶ç»™ Mockã€è¿­ä»£æ›´æ–°æ¨¡å—åˆ›é€ äº†æ¡ä»¶ã€‚</p><h2 id=ç”¨-go-è¯­è¨€å®ç°å®ƒ>ç”¨ Go è¯­è¨€å®ç°å®ƒ</h2><p>å‡è®¾ç°åœ¨è¦ä»ä¸€ä¸ªç”¨æˆ·çš„æœåŠ¡ä¸­æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªæ¥å£ï¼ŒUserRepository ä½œä¸ºæ•°æ®å±‚è´Ÿè´£æŸ¥è¯¢æ•°æ®åº“ï¼Œ UserService è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒä¾èµ– UserRepositoryã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜è¦å†™ä¸€ä¸ª Mock çš„æ•°æ®å±‚å®ç°ã€‚ æ•´ä¸ªç»“æ„å¦‚ä¸‹å›¾ã€‚</p><p><img src=/images/go-dependency-inject/example.png alt="Go example"></p><p>æ¥ä¸‹æ¥éå¸¸è½»æ¾åœ°ï¼Œæˆ‘ä»¬å®ç°ä¸¤ä¸ªæ¥å£ï¼Œå¹¶å†™äº†ä»–ä»¬çš„å®ç°ç±»ã€‚åŒæ—¶æˆ‘ä»¬è¿˜åœ¨ UserService çš„å®ç°ç±»é‡Œå†™äº†ä¸€ä¸ª NewUserServiceï¼Œæ¥æŠŠå®ƒä¾èµ–çš„ UserRepository å®ç°æ³¨å…¥è¿›æ¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åœ¨ user_repository.go ä¸­å®ç°å…·ä½“çš„æ¥å£
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Save</span>(<span style=color:#a6e22e>user</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ... å…·ä½“å®ç° UserRepositoryï¼Œç•¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// user_service.go ä¸­å®ç°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserService</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>age</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ... å…·ä½“å®ç° UserServiceï¼Œç•¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewUserService</span>(<span style=color:#a6e22e>repo</span> <span style=color:#a6e22e>UserRepository</span>) <span style=color:#a6e22e>UserService</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserServiceImpl</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>repo</span>: <span style=color:#a6e22e>repo</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯ä¸å¯ä»¥ç›´æ¥åœ¨ <code>user_service.go</code> ä¸­ç›´æ¥æŠŠ repository å¼•ç”¨è¿›æ¥å‘¢ï¼Ÿæ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºè¿™æ ·ï¼Œä¸¤ä¸ªæ¨¡å—å°±å½¢æˆäº†ä¾èµ–å…³ç³»ã€‚</p><p>è¿™ä¸€ç‚¹æ˜¯ä¾èµ–åè½¬çš„æ ¸å¿ƒï¼Œä¸Šå±‚æ¨¡å—ä¸ç›´æ¥å¼•ç”¨ä¸‹å±‚æ¨¡å—ï¼Œè€Œæ˜¯ç”±æ‰§è¡Œçš„ç±»æ¥åˆå§‹åŒ– Service å¹¶å°†ä¾èµ–çš„ä¸‹å±‚æœåŠ¡æ³¨å…¥è¿›æ¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åœ¨main.go ä¸­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>repo</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>MySQLUserRepository</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userService</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewUserService</span>(<span style=color:#a6e22e>repo</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·ï¼Œå½“ç¼–å†™æµ‹è¯• Mock ä»£ç æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç é€»è¾‘ï¼Œç›´æ¥åœ¨æµ‹è¯•ä¸­å°†<code>NewUserService</code> çš„å‚æ•°æ›¿æ¢æˆæµ‹è¯•çš„å‡å®ä¾‹å³å¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åœ¨ user_service_test.go ä¸­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestUserService</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>repo</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>MockTestUserRepository</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userService</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewUserService</span>(<span style=color:#a6e22e>repo</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦å¤–ï¼Œå¦‚æœæ•°æ®å±‚ä¿®æ”¹äº†å®ç°ï¼Œæˆ–è€…è¿ç§»åˆ°å¦å¤–çš„æ•°æ®åº“ï¼Œä½ åªéœ€è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼šæ•°æ®å±‚çš„å®ç°è€…å’Œä¾èµ–æ³¨å…¥è€…ã€‚å¯¹äºè°ƒç”¨è€… <code>UserService</code> åˆ™å®Œå…¨ä¸å—åˆ°å½±å“ã€‚æ•´ä¸ªé¡¹ç›®ä¹Ÿä¸ä¼šå½¢æˆä¾èµ–é™·é˜±ã€‚</p><h2 id=æ€»ç»“>æ€»ç»“</h2><p>ä¾èµ–å€’ç½®åŸåˆ™çš„ä¸¤ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š</p><ul><li>æ¨¡å—ä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼Œè€Œæ˜¯éƒ½ä¾èµ–äºæŠ½è±¡æ¥å£</li><li>æŠ½è±¡æ¥å£ä¸ä¾èµ–äºå®ç°ï¼Œè€Œå®ç°ä¾èµ–äºæŠ½è±¡æ¥å£</li></ul><p>åœ¨ Go è¯­è¨€ä¸­å®ç°è¿™ä¸¤æ¡åŸåˆ™å¹¶ä¸éº»çƒ¦ï¼Œåªè¦å°†åŸæœ¬çš„è°ƒç”¨æ–¹-å®ç°æ–¹ï¼Œè½¬æ¢æˆæ³¨å†Œæ–¹-è°ƒç”¨æ–¹-å®ç°æ–¹ã€‚åœ¨ Go ä¸­ä¹Ÿæœ‰ä¸€äº›åº“å’Œæ¡†æ¶å®ç°ä¾èµ–åè½¬ï¼Œå…¶å®æ ¸å¿ƒæ€æƒ³å¹¶æ²¡æœ‰å·®å¼‚ã€‚</p></content><p><a href=https://sund.site/tags/go/>#Go</a></p><div class=toc><nav id=TableOfContents><ul><li><a href=#ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®dip>ä¸ºä»€ä¹ˆè¦åšä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ï¼Ÿ</a></li><li><a href=#ç”¨-go-è¯­è¨€å®ç°å®ƒ>ç”¨ Go è¯­è¨€å®ç°å®ƒ</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></nav></div></main><footer>Subscribe via <a href=/index.xml>RSS</a>.<br>Made with
<a href=https://github.com/rokcso/hugo-bearblog-neo/>Hugo Bear Neo</a>.<br>Copyright Â© 2013-2025, Steve Sun.
ğŸ—ºï¸ <a href=/sitemap.xml>Sitemap</a>.</footer></body></html>